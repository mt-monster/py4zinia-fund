<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡åŒ–å°å·¥å…· - è¥¿ç“œé‡åŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .top-nav {
            background-color: #1a56db;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 18px;
            font-weight: bold;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-greeting {
            margin-right: 15px;
        }
        
        .nav-menu {
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .nav-menu span {
            margin-right: 5px;
        }
        
        /* å·¥å…·å¯¼èˆªåŒº */
        .tools-nav {
            background-color: white;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-item:hover {
            background-color: #e9e9e9;
        }
        
        /* å·¥å…·æ¨¡å—åŒº */
        .tools-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .tool-card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tool-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .tool-title {
            font-size: 16px;
            font-weight: bold;
            color: #1a56db;
        }
        
        /* åº•éƒ¨ç‰ˆæƒåŒº */
        .footer {
            margin-top: 40px;
            background-color: #1a56db;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 14px;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* åŠŸèƒ½èœå• */
        .function-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: #1a56db;
            color: white;
            padding: 20px;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .function-menu.active {
            right: 0;
        }
        
        .menu-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .menu-item {
            padding: 10px 0;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .menu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .menu-footer {
            position: absolute;
            bottom: 20px;
            width: calc(100% - 40px);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .tools-nav {
                grid-template-columns: 1fr;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="top-nav">
        <div class="logo">è¥¿ç“œé‡åŒ–å°å·¥å…·</div>
        <div class="user-info">
            <div class="user-greeting">Hi, Bysone</div>
            <div class="nav-menu" onclick="toggleMenu()">
                <span>åŠŸèƒ½å¯¼èˆª</span>
                <span>â˜°</span>
            </div>
        </div>
    </div>
    
    <!-- å·¥å…·å¯¼èˆªåŒº -->
    <div class="tools-nav">
        <div class="nav-item">
            <span>ğŸ“…</span> Aè‚¡æ—¥å†
        </div>
        <div class="nav-item">
            <span>ğŸ“¢</span> ETFå…¬å‘Š
        </div>
        <div class="nav-item">
            <span>ğŸ“‹</span> ETFåˆ—è¡¨
        </div>
    </div>
    
    <!-- å·¥å…·æ¨¡å—åŒº -->
    <div class="tools-container">
        <div class="tools-grid">
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ“Š</span> æ ¼é›·å„å§†æŒ‡æ•°
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸŒ¡ï¸</span> è¥¿ç“œé‡åŒ–æ¸©åº¦è®¡
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ“ˆ</span> æ³¢åŠ¨æ€§è®¡ç®—å™¨
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ”„</span> åœ¨çº¿å›æµ‹
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ¯</span> ç›¸å…³æ€§ç­›é€‰å™¨
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ’¼</span> å®ç›˜è´¦æœ¬
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ”</span> ç›¸å…³æ€§è®¡ç®—å™¨ä¸€
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ’°</span> å¤åˆ©è®¡ç®—å™¨
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ”</span> ç›¸å…³æ€§è®¡ç®—å™¨äºŒ
                </div>
            </div>
            <div class="tool-card">
                <div class="tool-title">
                    <span>ğŸ“Š</span> å†…éƒ¨æ”¶ç›Šè®¡ç®—å™¨
                </div>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨ç‰ˆæƒåŒº -->
    <div class="footer">
        <div class="footer-content">
            <p>æœ¬ç³»ç»Ÿä»…ä½œå­¦ä¹ ç ”ç©¶ä¹‹ç”¨ï¼Œä¸ä½œä»»ä½•æŠ•èµ„å»ºè®®ï¼Œä¸æ‰¿æ‹…ç”±æ­¤å¯¼è‡´çš„ä»»ä½•è´£ä»»ï¼</p>
            <p>é£é™©æç¤º Â© Copyright è¥¿ç“œé‡åŒ–</p>
        </div>
    </div>
    
    <!-- åŠŸèƒ½èœå• -->
    <div class="function-menu" id="functionMenu">
        <div class="menu-header">å†…ç½®ç­–ç•¥</div>
        <div class="menu-item">ç­–ç•¥æ’å</div>
        <div class="menu-item">æˆ‘çš„ç­–ç•¥</div>
        <div class="menu-item">ç»„åˆæ’å</div>
        <div class="menu-item">æˆ‘çš„ç»„åˆ</div>
        <a href="/tools" class="menu-item" style="color: white; text-decoration: none; display: block;">é‡åŒ–å°å·¥å…·</a>
        <div class="menu-item">åœ¨çº¿å›æµ‹</div>
        <div class="menu-item">å…³äºæˆ‘ä»¬</div>
        <a href="/ledger" class="menu-item" style="color: white; text-decoration: none; display: block;">å®ç›˜è´¦æœ¬</a>
        <div class="menu-item">å¸¸è§é—®é¢˜</div>
        <div class="menu-item">ä¸ªäººèµ„æ–™</div>
        <div class="menu-item">è‡ªåŠ¨äº¤æ˜“</div>
        <div class="menu-item">æŒ‡æ•°è·ŸæŠ•</div>
        <div class="menu-footer">
            <div class="menu-item">é€€å‡º</div>
        </div>
    </div>
    
    <!-- å·¥å…·æ¨¡æ€æ¡† -->
    <div id="toolModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">å·¥å…·è¯¦æƒ…</h2>
            <div id="modalBody">
                <!-- å·¥å…·å†…å®¹å°†åŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <script>
        // åˆ‡æ¢åŠŸèƒ½èœå•
        function toggleMenu() {
            const menu = document.getElementById('functionMenu');
            menu.classList.toggle('active');
        }

        // å·¥å…·å¡ç‰‡ç‚¹å‡»äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–æ‰€æœ‰å·¥å…·å¡ç‰‡
            const toolCards = document.querySelectorAll('.tool-card');
            
            toolCards.forEach(card => {
                card.addEventListener('click', function() {
                    const titleElement = this.querySelector('.tool-title');
                    const titleText = titleElement.textContent.trim();
                    
                    // æ ¹æ®å·¥å…·æ ‡é¢˜æ‰“å¼€ç›¸åº”çš„å·¥å…·
                    switch(titleText.replace(/^[^\u4e00-\u9fa5]*[\u4e00-\u9fa5]/, function(match) { 
                        return match.slice(-1); 
                    })) {
                        case 'æ ¼é›·å„å§†æŒ‡æ•°':
                            openGrahamIndex();
                            break;
                        case 'è¥¿ç“œé‡åŒ–æ¸©åº¦è®¡':
                            openWatermelonThermometer();
                            break;
                        case 'æ³¢åŠ¨æ€§è®¡ç®—å™¨':
                            openVolatilityCalculator();
                            break;
                        case 'ç›¸å…³æ€§ç­›é€‰å™¨':
                            openCorrelationFilter();
                            break;
                        case 'å¤åˆ©è®¡ç®—å™¨':
                            openCompoundCalculator();
                            break;
                        case 'ç›¸å…³æ€§è®¡ç®—å™¨ä¸€':
                            openCorrelationCalculator1();
                            break;
                        case 'ç›¸å…³æ€§è®¡ç®—å™¨äºŒ':
                            openCorrelationCalculator2();
                            break;
                        case 'å†…éƒ¨æ”¶ç›Šè®¡ç®—å™¨':
                            openIRRcalculator();
                            break;
                        case 'åœ¨çº¿å›æµ‹':
                            alert('åœ¨çº¿å›æµ‹åŠŸèƒ½å¼€å‘ä¸­...');
                            break;
                        case 'å®ç›˜è´¦æœ¬':
                            window.location.href = '/ledger';
                            break;
                        default:
                            alert('åŠŸèƒ½å¼€å‘ä¸­...');
                    }
                });
            });
        });

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('toolModal').style.display = 'block';
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('toolModal').style.display = 'none';
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('toolModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // æ ¼é›·å„å§†æŒ‡æ•°å·¥å…·
        function openGrahamIndex() {
            const content = `
                <div class="graham-index-tool">
                    <div class="tool-info">
                        <p>æ ¼é›·å„å§†æŒ‡æ•°æ˜¯æœ¬æ°æ˜Â·æ ¼é›·å„å§†æå‡ºçš„ä¸€ä¸ªè¯„ä¼°è‚¡ç¥¨å¸‚åœºæ•´ä½“ä¼°å€¼æ°´å¹³çš„æŒ‡æ ‡ã€‚</p>
                        <p>è®¡ç®—å…¬å¼ï¼š(ç›ˆåˆ©æ”¶ç›Šç‡ Ã— 100) / (4.4 Ã— å¸‚å‡€ç‡)</p>
                        <p>å…¶ä¸­4.4ä¸ºAAAçº§å…¬å¸å€ºåˆ¸çš„æ”¶ç›Šç‡åŸºå‡†ã€‚</p>
                    </div>
                    <button onclick="calculateGrahamIndex()" class="calculate-btn">è·å–å½“å‰æŒ‡æ•°</button>
                    <div id="grahamResult" class="result-section"></div>
                </div>
            `;
            showModal('æ ¼é›·å„å§†æŒ‡æ•°', content);
        }

        async function calculateGrahamIndex() {
            try {
                const response = await fetch('/api/graham-index');
                const data = await response.json();
                
                document.getElementById('grahamResult').innerHTML = `
                    <div class="result-item">
                        <h3>å½“å‰æ ¼é›·å„å§†æŒ‡æ•°: ${data.value}</h3>
                        <p>å¸‚ç›ˆç‡ (P/E): ${data.pe_ratio}</p>
                        <p>å¸‚å‡€ç‡ (P/B): ${data.pb_ratio}</p>
                        <p>ä¼°å€¼åˆ¤æ–­: <strong>${data.interpretation}</strong></p>
                        <div class="valuation-explanation">
                            <p><strong>æŒ‡æ•°è§£è¯»ï¼š</strong></p>
                            <ul>
                                <li>æŒ‡æ•° > 1: å¸‚åœºè¢«é«˜ä¼°</li>
                                <li>æŒ‡æ•° < 1: å¸‚åœºè¢«ä½ä¼°</li>
                                <li>æŒ‡æ•° â‰ˆ 1: å¸‚åœºä¼°å€¼åˆç†</li>
                            </ul>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('grahamResult').innerHTML = `<p class="error">è·å–æ•°æ®å¤±è´¥: ${error.message}</p>`;
            }
        }

        // è¥¿ç“œé‡åŒ–æ¸©åº¦è®¡
        function openWatermelonThermometer() {
            const content = `
                <div class="thermometer-tool">
                    <div class="tool-info">
                        <p>è¥¿ç“œé‡åŒ–æ¸©åº¦è®¡æ˜¯è¡¡é‡å¸‚åœºæƒ…ç»ªçš„ç»¼åˆæŒ‡æ ‡ã€‚</p>
                        <p>æ•°å€¼èŒƒå›´ï¼š0-100ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºå¸‚åœºæƒ…ç»ªè¶Šä¹è§‚ã€‚</p>
                    </div>
                    <button onclick="getThermometerReading()" class="calculate-btn">è·å–å½“å‰æ¸©åº¦</button>
                    <div id="thermometerResult" class="result-section"></div>
                </div>
            `;
            showModal('è¥¿ç“œé‡åŒ–æ¸©åº¦è®¡', content);
        }

        async function getThermometerReading() {
            try {
                const response = await fetch('/api/watermelon-thermometer');
                const data = await response.json();
                
                document.getElementById('thermometerResult').innerHTML = `
                    <div class="result-item">
                        <div class="thermometer-display" style="background-color: ${data.color}; color: white; padding: 20px; border-radius: 10px; text-align: center; font-size: 24px;">
                            <div>å¸‚åœºæƒ…ç»ªæ¸©åº¦</div>
                            <div style="font-size: 48px; font-weight: bold;">${data.temperature}Â°C</div>
                            <div>çŠ¶æ€: ${data.status}</div>
                        </div>
                        <div class="status-explanation">
                            <p><strong>çŠ¶æ€è§£è¯»ï¼š</strong></p>
                            <ul>
                                <li>å†°ç‚¹ (0-20Â°C): å¸‚åœºæåº¦æ‚²è§‚ï¼Œå¯èƒ½æ˜¯ä¹°å…¥æœºä¼š</li>
                                <li>å¯’å†· (20-40Â°C): å¸‚åœºè¾ƒä¸ºæ‚²è§‚ï¼Œè°¨æ…è§‚æœ›</li>
                                <li>æ¸©å’Œ (40-60Â°C): å¸‚åœºæƒ…ç»ªå¹³ç¨³ï¼Œæ­£å¸¸æ“ä½œ</li>
                                <li>ç‚çƒ­ (60-80Â°C): å¸‚åœºè¾ƒä¸ºä¹è§‚ï¼Œæ³¨æ„é£é™©</li>
                                <li>è¿‡çƒ­ (80-100Â°C): å¸‚åœºæåº¦ä¹è§‚ï¼Œè­¦æƒ•å›è°ƒ</li>
                            </ul>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('thermometerResult').innerHTML = `<p class="error">è·å–æ•°æ®å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æ³¢åŠ¨æ€§è®¡ç®—å™¨
        function openVolatilityCalculator() {
            const content = `
                <div class="volatility-calculator-tool">
                    <div class="tool-info">
                        <p>æ³¢åŠ¨æ€§æ˜¯è¡¡é‡èµ„äº§ä»·æ ¼å˜åŒ–å¹…åº¦çš„æŒ‡æ ‡ï¼Œé€šå¸¸ç”¨æ ‡å‡†å·®æ¥è¡¨ç¤ºã€‚</p>
                        <p>è¾“å…¥å†å²ä»·æ ¼æ•°æ®ï¼Œè®¡ç®—å¹´åŒ–æ³¢åŠ¨ç‡ã€‚</p>
                    </div>
                    <label for="priceInput">è¯·è¾“å…¥ä»·æ ¼æ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="priceInput" placeholder="ä¾‹å¦‚: 100,102,98,105,103" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <button onclick="calculateVolatility()" class="calculate-btn">è®¡ç®—æ³¢åŠ¨ç‡</button>
                    <div id="volatilityResult" class="result-section"></div>
                </div>
            `;
            showModal('æ³¢åŠ¨æ€§è®¡ç®—å™¨', content);
        }

        async function calculateVolatility() {
            const priceInput = document.getElementById('priceInput').value;
            if (!priceInput) {
                alert('è¯·è¾“å…¥ä»·æ ¼æ•°æ®');
                return;
            }
            
            const prices = priceInput.split(',').map(price => parseFloat(price.trim())).filter(price => !isNaN(price));
            
            if (prices.length < 2) {
                alert('è‡³å°‘éœ€è¦2ä¸ªä»·æ ¼æ•°æ®ç‚¹');
                return;
            }
            
            try {
                const response = await fetch('/api/volatility-calculator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prices: prices })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('volatilityResult').innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }
                
                document.getElementById('volatilityResult').innerHTML = `
                    <div class="result-item">
                        <h3>æ³¢åŠ¨ç‡åˆ†æç»“æœ</h3>
                        <p>å¹´åŒ–æ³¢åŠ¨ç‡: <strong>${data.volatility}%</strong></p>
                        <p>å¹³å‡æ”¶ç›Šç‡: ${data.avg_return}%</p>
                        <div class="returns-section">
                            <h4>å„æœŸæ”¶ç›Šç‡:</h4>
                            <ul>
                                ${data.returns.map((ret, idx) => `<li>ç¬¬${idx + 1}æœŸ: ${ret}%</li>`).join('')}
                            </ul>
                        </div>
                        <div class="volatility-explanation">
                            <p><strong>æ³¢åŠ¨ç‡è§£è¯»ï¼š</strong></p>
                            <ul>
                                <li>ä½æ³¢åŠ¨ç‡ (< 15%): é£é™©è¾ƒä½ï¼Œä»·æ ¼ç›¸å¯¹ç¨³å®š</li>
                                <li>ä¸­æ³¢åŠ¨ç‡ (15%-30%): ä¸­ç­‰é£é™©ï¼Œä»·æ ¼æœ‰ä¸€å®šæ³¢åŠ¨</li>
                                <li>é«˜æ³¢åŠ¨ç‡ (> 30%): é«˜é£é™©ï¼Œä»·æ ¼æ³¢åŠ¨å‰§çƒˆ</li>
                            </ul>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('volatilityResult').innerHTML = `<p class="error">è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }

        // ç›¸å…³æ€§ç­›é€‰å™¨
        function openCorrelationFilter() {
            const content = `
                <div class="correlation-filter-tool">
                    <div class="tool-info">
                        <p>è®¡ç®—ä¸¤ä¸ªèµ„äº§ä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼Œå¸®åŠ©æ‚¨æ„å»ºä½ç›¸å…³æ€§çš„æŠ•èµ„ç»„åˆã€‚</p>
                        <p>ç›¸å…³ç³»æ•°èŒƒå›´ï¼š-1 åˆ° 1ï¼Œè¶Šæ¥è¿‘0è¡¨ç¤ºç›¸å…³æ€§è¶Šä½ã€‚</p>
                    </div>
                    <label for="asset1Input">èµ„äº§1æ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="asset1Input" placeholder="ä¾‹å¦‚: 100,102,98,105,103" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <label for="asset2Input">èµ„äº§2æ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="asset2Input" placeholder="ä¾‹å¦‚: 200,210,195,208,205" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <button onclick="calculateCorrelation()" class="calculate-btn">è®¡ç®—ç›¸å…³æ€§</button>
                    <div id="correlationResult" class="result-section"></div>
                </div>
            `;
            showModal('ç›¸å…³æ€§ç­›é€‰å™¨', content);
        }

        async function calculateCorrelation() {
            const asset1Input = document.getElementById('asset1Input').value;
            const asset2Input = document.getElementById('asset2Input').value;
            
            if (!asset1Input || !asset2Input) {
                alert('è¯·è¾“å…¥ä¸¤ä¸ªèµ„äº§çš„æ•°æ®');
                return;
            }
            
            const asset1 = asset1Input.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            const asset2 = asset2Input.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            
            if (asset1.length !== asset2.length || asset1.length < 2) {
                alert('ä¸¤ä¸ªèµ„äº§åºåˆ—é•¿åº¦å¿…é¡»ç›¸åŒä¸”è‡³å°‘æœ‰2ä¸ªæ•°æ®ç‚¹');
                return;
            }
            
            try {
                const response = await fetch('/api/correlation-filter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ asset1: asset1, asset2: asset2 })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('correlationResult').innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }
                
                document.getElementById('correlationResult').innerHTML = `
                    <div class="result-item">
                        <h3>ç›¸å…³æ€§åˆ†æç»“æœ</h3>
                        <p>ç›¸å…³ç³»æ•°: <strong>${data.correlation}</strong></p>
                        <p>ç›¸å…³ç¨‹åº¦: ${data.interpretation}</p>
                        <div class="correlation-explanation">
                            <p><strong>ç›¸å…³æ€§è§£è¯»ï¼š</strong></p>
                            <ul>
                                <li>å¼ºæ­£ç›¸å…³ (> 0.7): ä¸¤ä¸ªèµ„äº§èµ°åŠ¿é«˜åº¦ä¸€è‡´</li>
                                <li>ä¸­ç­‰ç›¸å…³ (0.3-0.7): ä¸¤ä¸ªèµ„äº§æœ‰ä¸€å®šå…³è”</li>
                                <li>å¼±ç›¸å…³ (< 0.3): ä¸¤ä¸ªèµ„äº§å‡ ä¹æ— å…³</li>
                                <li>è´Ÿç›¸å…³ (< 0): ä¸¤ä¸ªèµ„äº§èµ°åŠ¿ç›¸å</li>
                            </ul>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('correlationResult').innerHTML = `<p class="error">è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }

        // å¤åˆ©è®¡ç®—å™¨
        function openCompoundCalculator() {
            const content = `
                <div class="compound-calculator-tool">
                    <div class="tool-info">
                        <p>å¤åˆ©æ˜¯æŒ‡åœ¨è®¡ç®—åˆ©æ¯æ—¶ï¼ŒæŸä¸€è®¡æ¯å‘¨æœŸçš„åˆ©æ¯æ˜¯ç”±æœ¬é‡‘åŠ ä¸Šå…ˆå‰å‘¨æœŸæ‰€ç§¯ç´¯çš„åˆ©æ¯æ€»é¢æ¥è®¡ç®—çš„è®¡æ¯æ–¹å¼ã€‚</p>
                    </div>
                    <div class="form-group">
                        <label for="principalInput">æœ¬é‡‘:</label>
                        <input type="number" id="principalInput" placeholder="ä¾‹å¦‚: 10000" min="0" step="any" style="width: 100%; padding: 8px; margin: 5px 0;">
                    </div>
                    <div class="form-group">
                        <label for="rateInput">å¹´åŒ–æ”¶ç›Šç‡ (%):</label>
                        <input type="number" id="rateInput" placeholder="ä¾‹å¦‚: 8" min="0" step="any" style="width: 100%; padding: 8px; margin: 5px 0;">
                    </div>
                    <div class="form-group">
                        <label for="timeInput">æŠ•èµ„å¹´é™:</label>
                        <input type="number" id="timeInput" placeholder="ä¾‹å¦‚: 10" min="0" step="any" style="width: 100%; padding: 8px; margin: 5px 0;">
                    </div>
                    <div class="form-group">
                        <label for="frequencyInput">å¤åˆ©é¢‘ç‡ (æ¯å¹´å¤åˆ©æ¬¡æ•°):</label>
                        <select id="frequencyInput" style="width: 100%; padding: 8px; margin: 5px 0;">
                            <option value="1">æ¯å¹´ä¸€æ¬¡</option>
                            <option value="2">æ¯åŠå¹´ä¸€æ¬¡</option>
                            <option value="4">æ¯å­£åº¦ä¸€æ¬¡</option>
                            <option value="12">æ¯æœˆä¸€æ¬¡</option>
                            <option value="365">æ¯æ—¥ä¸€æ¬¡</option>
                        </select>
                    </div>
                    <button onclick="calculateCompound()" class="calculate-btn">è®¡ç®—å¤åˆ©</button>
                    <div id="compoundResult" class="result-section"></div>
                </div>
            `;
            showModal('å¤åˆ©è®¡ç®—å™¨', content);
        }

        async function calculateCompound() {
            const principal = parseFloat(document.getElementById('principalInput').value);
            const rate = parseFloat(document.getElementById('rateInput').value);
            const time = parseFloat(document.getElementById('timeInput').value);
            const frequency = parseInt(document.getElementById('frequencyInput').value);
            
            if (isNaN(principal) || isNaN(rate) || isNaN(time)) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
                return;
            }
            
            if (principal <= 0 || rate < 0 || time <= 0) {
                alert('æœ¬é‡‘å’ŒæŠ•èµ„å¹´é™å¿…é¡»å¤§äº0ï¼Œå¹´åŒ–æ”¶ç›Šç‡ä¸èƒ½å°äº0');
                return;
            }
            
            try {
                const response = await fetch('/api/compound-calculator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        principal: principal, 
                        rate: rate, 
                        time: time, 
                        frequency: frequency 
                    })
                });
                
                const data = await response.json();
                
                document.getElementById('compoundResult').innerHTML = `
                    <div class="result-item">
                        <h3>å¤åˆ©è®¡ç®—ç»“æœ</h3>
                        <p>åˆå§‹æœ¬é‡‘: Â¥${principal.toLocaleString()}</p>
                        <p>å¹´åŒ–æ”¶ç›Šç‡: ${rate}%</p>
                        <p>æŠ•èµ„å¹´é™: ${time}å¹´</p>
                        <p>å¤åˆ©é¢‘ç‡: ${frequency}æ¬¡/å¹´</p>
                        <p>æœ€ç»ˆé‡‘é¢: <strong>Â¥${data.final_amount.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></p>
                        <p>ç´¯è®¡æ”¶ç›Š: Â¥${data.interest_earned.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
                        <p>æ€»æ”¶ç›Šç‡: ${data.total_return}%</p>
                        <div class="compound-explanation">
                            <p><strong>å¤åˆ©æ•ˆåº”ï¼š</strong>å¤åˆ©è¢«ç§°ä¸º"ä¸–ç•Œç¬¬å…«å¤§å¥‡è¿¹"ï¼Œé•¿æœŸæŠ•èµ„ä¸­å¤åˆ©æ•ˆåº”ä¼šæ˜¾è‘—å¢åŠ æ”¶ç›Šã€‚</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('compoundResult').innerHTML = `<p class="error">è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }

        // ç›¸å…³æ€§è®¡ç®—å™¨ä¸€
        function openCorrelationCalculator1() {
            const content = `
                <div class="correlation-calculator-tool">
                    <div class="tool-info">
                        <p>è®¡ç®—ä¸¤ç»„æ•°æ®ä¹‹é—´çš„çš®å°”é€Šç›¸å…³ç³»æ•°ã€‚</p>
                        <p>ç›¸å…³ç³»æ•°èŒƒå›´ï¼š-1 åˆ° 1ï¼Œåæ˜ å˜é‡é—´çš„çº¿æ€§å…³ç³»å¼ºåº¦å’Œæ–¹å‘ã€‚</p>
                    </div>
                    <label for="seriesAInput">åºåˆ—Aæ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="seriesAInput" placeholder="ä¾‹å¦‚: 1,2,3,4,5" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <label for="seriesBInput">åºåˆ—Bæ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="seriesBInput" placeholder="ä¾‹å¦‚: 2,4,6,8,10" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <button onclick="calculateCorrelation1()" class="calculate-btn">è®¡ç®—ç›¸å…³ç³»æ•°</button>
                    <div id="correlation1Result" class="result-section"></div>
                </div>
            `;
            showModal('ç›¸å…³æ€§è®¡ç®—å™¨ä¸€', content);
        }

        async function calculateCorrelation1() {
            const seriesAInput = document.getElementById('seriesAInput').value;
            const seriesBInput = document.getElementById('seriesBInput').value;
            
            if (!seriesAInput || !seriesBInput) {
                alert('è¯·è¾“å…¥ä¸¤ä¸ªåºåˆ—çš„æ•°æ®');
                return;
            }
            
            const seriesA = seriesAInput.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            const seriesB = seriesBInput.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            
            if (seriesA.length !== seriesB.length || seriesA.length < 2) {
                alert('ä¸¤ä¸ªåºåˆ—é•¿åº¦å¿…é¡»ç›¸åŒä¸”è‡³å°‘æœ‰2ä¸ªæ•°æ®ç‚¹');
                return;
            }
            
            try {
                const response = await fetch('/api/correlation-calculator-1', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ series_a: seriesA, series_b: seriesB })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('correlation1Result').innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }
                
                document.getElementById('correlation1Result').innerHTML = `
                    <div class="result-item">
                        <h3>ç›¸å…³æ€§åˆ†æç»“æœ</h3>
                        <p>ç›¸å…³ç³»æ•°: <strong>${data.correlation}</strong></p>
                        <p>ç›¸å…³å¼ºåº¦: ${data.strength}</p>
                        <div class="correlation-details">
                            <h4>æ•°æ®è¯¦æƒ…:</h4>
                            <p>åºåˆ—A: [${seriesA.join(', ')}]</p>
                            <p>åºåˆ—B: [${seriesB.join(', ')}]</p>
                            <p>æ•°æ®ç‚¹æ•°: ${seriesA.length}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('correlation1Result').innerHTML = `<p class="error">è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }

        // ç›¸å…³æ€§è®¡ç®—å™¨äºŒ
        function openCorrelationCalculator2() {
            const content = `
                <div class="correlation-calculator-tool">
                    <div class="tool-info">
                        <p>å¦ä¸€ç§è®¡ç®—Xä¸Yå˜é‡ä¹‹é—´ç›¸å…³æ€§çš„æ–¹æ³•ã€‚</p>
                        <p>ç›¸å…³ç³»æ•°èŒƒå›´ï¼š-1 åˆ° 1ï¼Œæ­£å€¼è¡¨ç¤ºæ­£ç›¸å…³ï¼Œè´Ÿå€¼è¡¨ç¤ºè´Ÿç›¸å…³ã€‚</p>
                    </div>
                    <label for="xValuesInput">Xå€¼æ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="xValuesInput" placeholder="ä¾‹å¦‚: 1,2,3,4,5" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <label for="yValuesInput">Yå€¼æ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰:</label>
                    <input type="text" id="yValuesInput" placeholder="ä¾‹å¦‚: 2,4,6,8,10" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <button onclick="calculateCorrelation2()" class="calculate-btn">è®¡ç®—ç›¸å…³æ€§</button>
                    <div id="correlation2Result" class="result-section"></div>
                </div>
            `;
            showModal('ç›¸å…³æ€§è®¡ç®—å™¨äºŒ', content);
        }

        async function calculateCorrelation2() {
            const xValuesInput = document.getElementById('xValuesInput').value;
            const yValuesInput = document.getElementById('yValuesInput').value;
            
            if (!xValuesInput || !yValuesInput) {
                alert('è¯·è¾“å…¥Xå’ŒYçš„æ•°æ®');
                return;
            }
            
            const xValues = xValuesInput.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            const yValues = yValuesInput.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            
            if (xValues.length !== yValues.length || xValues.length < 2) {
                alert('Xå’ŒYåºåˆ—é•¿åº¦å¿…é¡»ç›¸åŒä¸”è‡³å°‘æœ‰2ä¸ªæ•°æ®ç‚¹');
                return;
            }
            
            try {
                const response = await fetch('/api/correlation-calculator-2', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ x_values: xValues, y_values: yValues })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('correlation2Result').innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }
                
                document.getElementById('correlation2Result').innerHTML = `
                    <div class="result-item">
                        <h3>ç›¸å…³æ€§åˆ†æç»“æœ</h3>
                        <p>ç›¸å…³ç³»æ•°: <strong>${data.correlation}</strong></p>
                        <p>ç›¸å…³æ–¹å‘: ${data.direction}</p>
                        <div class="correlation-details">
                            <h4>æ•°æ®è¯¦æƒ…:</h4>
                            <p>Xå€¼: [${xValues.join(', ')}]</p>
                            <p>Yå€¼: [${yValues.join(', ')}]</p>
                            <p>æ•°æ®ç‚¹æ•°: ${xValues.length}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('correlation2Result').innerHTML = `<p class="error">è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }

        // å†…éƒ¨æ”¶ç›Šè®¡ç®—å™¨ (IRR)
        function openIRRcalculator() {
            const content = `
                <div class="irr-calculator-tool">
                    <div class="tool-info">
                        <p>å†…éƒ¨æ”¶ç›Šç‡(IRR)æ˜¯ä½¿é¡¹ç›®å‡€ç°å€¼(NPV)ä¸ºé›¶çš„æŠ˜ç°ç‡ã€‚</p>
                        <p>ç”¨äºè¯„ä¼°æŠ•èµ„é¡¹ç›®çš„çœŸå®æ”¶ç›Šç‡ï¼Œæ­£å€¼è¡¨ç¤ºç›ˆåˆ©ï¼Œè´Ÿå€¼è¡¨ç¤ºäºæŸã€‚</p>
                    </div>
                    <label for="cashFlowsInput">ç°é‡‘æµæ•°æ®ï¼ˆç”¨é€—å·åˆ†éš”ï¼Œè´Ÿæ•°è¡¨ç¤ºæ”¯å‡ºï¼Œæ­£æ•°è¡¨ç¤ºæ”¶å…¥ï¼‰:</label>
                    <input type="text" id="cashFlowsInput" placeholder="ä¾‹å¦‚: -1000,300,350,400,450" style="width: 100%; padding: 8px; margin: 10px 0;">
                    <button onclick="calculateIRR()" class="calculate-btn">è®¡ç®—å†…éƒ¨æ”¶ç›Šç‡</button>
                    <div id="irrResult" class="result-section"></div>
                </div>
            `;
            showModal('å†…éƒ¨æ”¶ç›Šè®¡ç®—å™¨', content);
        }

        async function calculateIRR() {
            const cashFlowsInput = document.getElementById('cashFlowsInput').value;
            
            if (!cashFlowsInput) {
                alert('è¯·è¾“å…¥ç°é‡‘æµæ•°æ®');
                return;
            }
            
            const cashFlows = cashFlowsInput.split(',').map(val => parseFloat(val.trim())).filter(val => !isNaN(val));
            
            if (cashFlows.length < 2) {
                alert('è‡³å°‘éœ€è¦2ä¸ªç°é‡‘æµæ•°æ®ç‚¹');
                return;
            }
            
            try {
                const response = await fetch('/api/irr-calculator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ cash_flows: cashFlows })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    document.getElementById('irrResult').innerHTML = `<p class="error">${data.error}</p>`;
                    return;
                }
                
                document.getElementById('irrResult').innerHTML = `
                    <div class="result-item">
                        <h3>å†…éƒ¨æ”¶ç›Šç‡è®¡ç®—ç»“æœ</h3>
                        <p>å†…éƒ¨æ”¶ç›Šç‡(IRR): <strong>${data.irr}%</strong></p>
                        <div class="cash-flows-details">
                            <h4>ç°é‡‘æµè¯¦æƒ…:</h4>
                            <ul>
                                ${cashFlows.map((cf, idx) => `<li>ç¬¬${idx + 1}æœŸ: ${cf >= 0 ? '+' : ''}${cf}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="irr-explanation">
                            <p><strong>IRRè§£è¯»ï¼š</strong></p>
                            <ul>
                                <li>IRR > 0%: æŠ•èµ„é¡¹ç›®ç›ˆåˆ©</li>
                                <li>IRR < 0%: æŠ•èµ„é¡¹ç›®äºæŸ</li>
                                <li>IRRè¶Šé«˜ï¼ŒæŠ•èµ„å›æŠ¥è¶Šå¥½</li>
                            </ul>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('irrResult').innerHTML = `<p class="error">è®¡ç®—å¤±è´¥: ${error.message}</p>`;
            }
        }

        // å¯¼èˆªé¡¹ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                const navText = this.textContent.trim();
                
                if (navText.includes('Aè‚¡æ—¥å†')) {
                    openChinaStockCalendar();
                } else if (navText.includes('ETFå…¬å‘Š')) {
                    openETFAnnouncements();
                } else if (navText.includes('ETFåˆ—è¡¨')) {
                    openETFList();
                }
            });
        });

        // Aè‚¡æ—¥å†åŠŸèƒ½
        function openChinaStockCalendar() {
            const content = `
                <div class="calendar-tool">
                    <div class="tool-info">
                        <p>Aè‚¡äº¤æ˜“æ—¥å†ï¼Œæ˜¾ç¤ºè¿‘æœŸçš„å¼€å¸‚å’Œä¼‘å¸‚å®‰æ’ã€‚</p>
                    </div>
                    <button onclick="loadCalendar()" class="calculate-btn">åŠ è½½æ—¥å†</button>
                    <div id="calendarResult" class="result-section"></div>
                </div>
            `;
            showModal('Aè‚¡æ—¥å†', content);
        }

        async function loadCalendar() {
            try {
                const response = await fetch('/api/china-stock-calendar');
                const data = await response.json();
                
                document.getElementById('calendarResult').innerHTML = `
                    <div class="result-item">
                        <h3>å½“å‰æ—¥æœŸ: ${data.current_date}</h3>
                        <table class="calendar-table">
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>ç±»å‹</th>
                                    <th>è¯´æ˜</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.calendar.map(day => `
                                    <tr class="${day.type}">
                                        <td>${day.date}</td>
                                        <td>${day.type === 'trading_day' ? 'å¼€å¸‚' : 'ä¼‘å¸‚'}</td>
                                        <td>${day.description}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            } catch (error) {
                document.getElementById('calendarResult').innerHTML = `<p class="error">åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }

        // ETFå…¬å‘ŠåŠŸèƒ½
        function openETFAnnouncements() {
            const content = `
                <div class="announcements-tool">
                    <div class="tool-info">
                        <p>æœ€æ–°çš„ETFäº§å“å…¬å‘Šä¿¡æ¯ã€‚</p>
                    </div>
                    <button onclick="loadAnnouncements()" class="calculate-btn">åŠ è½½å…¬å‘Š</button>
                    <div id="announcementsResult" class="result-section"></div>
                </div>
            `;
            showModal('ETFå…¬å‘Š', content);
        }

        async function loadAnnouncements() {
            try {
                const response = await fetch('/api/etf-announcements');
                const data = await response.json();
                
                document.getElementById('announcementsResult').innerHTML = `
                    <div class="result-item">
                        <h3>æœ€æ–°ETFå…¬å‘Š</h3>
                        <div class="announcements-list">
                            ${data.announcements.map(announcement => `
                                <div class="announcement-item">
                                    <h4>${announcement.title}</h4>
                                    <p>åŸºé‡‘ä»£ç : ${announcement.fund_code}</p>
                                    <p>å…¬å‘Šç±»å‹: ${announcement.type}</p>
                                    <p>å‘å¸ƒæ—¥æœŸ: ${announcement.date}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('announcementsResult').innerHTML = `<p class="error">åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }

        // ETFåˆ—è¡¨åŠŸèƒ½
        function openETFList() {
            const content = `
                <div class="etf-list-tool">
                    <!-- æ ‡é¢˜å’Œè¯´æ˜ -->
                    <div class="tool-info">
                        <h3>ETFåˆ—è¡¨</h3>
                        <p>1. æœ¬åˆ—è¡¨æä¾›äº†ETFä¸æŒ‡æ•°ã€åŸºé‡‘å…¬å¸é—´çš„äº’æŸ¥åŠŸèƒ½ï¼Œå¯åœ¨æœç´¢æ¡†ä¸­è¾“å…¥æŒ‡æ•°ä»£ç ã€æŒ‡æ•°åç§°ã€ETFä»£ç ã€ETFåç§°ã€åŸºé‡‘å…¬å¸åç§°è¿›è¡Œæœç´¢ï¼›æœ¬è¡¨æ ¼åŒæ—¶è¿˜ç»Ÿè®¡äº†ETFè¿‘æœŸæ—¥å‡æˆäº¤é¢ç­‰æ•°æ®ï¼Œæ–¹ä¾¿å¤§å®¶è¿½è¸ªETFã€‚</p>
                        <p>2. <span style="color: red;">â—</span> å“ªäº›ETFå¯ä»¥T+0ï¼Ÿ</p>
                        <p>3. æ•°æ®æ›´æ–°è‡³2026å¹´1æœˆ9æ—¥15æ—¶30åˆ†(ETFä¸Šå¸‚äº¤æ˜“1å‘¨å·¦å³æ”¶å½•ï¼Œ<a href="#">æ”¶å½•æ—¥å¿—</a>)ã€‚</p>
                    </div>
                    
                    <!-- åˆ†ç±»æ ‡ç­¾ -->
                    <div class="etf-category-tabs">
                        <button class="category-tab active" data-category="all">å…¨éƒ¨</button>
                        <button class="category-tab" data-category="è‚¡ç¥¨ETF">è‚¡ç¥¨/æœŸè´§/å€ºåˆ¸ETF</button>
                        <button class="category-tab" data-category="é»„é‡‘ETF">é»„é‡‘ETF</button>
                        <button class="category-tab" data-category="è´§å¸ETF">è´§å¸ETF</button>
                    </div>
                    
                    <!-- ç­›é€‰æ ‡ç­¾ -->
                    <div class="etf-subcategory-tabs">
                        <button class="subcategory-tab active" data-subcategory="all">å…¨éƒ¨</button>
                        <button class="subcategory-tab" data-subcategory="å®½åŸº">å®½åŸº</button>
                        <button class="subcategory-tab" data-subcategory="è¡Œä¸š">è¡Œä¸š</button>
                        <button class="subcategory-tab" data-subcategory="Aè‚¡">Aè‚¡</button>
                        <button class="subcategory-tab" data-subcategory="QDII">QDII</button>
                        <button class="subcategory-tab" data-subcategory="æœŸè´§">æœŸè´§</button>
                        <button class="subcategory-tab" data-subcategory="å€ºåˆ¸">å€ºåˆ¸</button>
                    </div>
                    
                    <!-- ç­›é€‰å’Œæœç´¢åŒº -->
                    <div class="etf-filter-section">
                        <div class="volume-filter">
                            <label for="volumeMin">æˆäº¤é¢</label>
                            <input type="number" id="volumeMin" placeholder="0" style="width: 80px; padding: 5px; margin: 0 5px;">
                            <span>ä¸‡ä»¥ä¸Š</span>
                        </div>
                        
                        <div class="search-section">
                            <input type="text" id="etfSearch" placeholder="æœç´¢æŒ‡æ•°ä»£ç ã€åç§°ã€ETFä»£ç ã€åç§°ã€åŸºé‡‘å…¬å¸" style="padding: 5px; margin-right: 10px; width: 300px;">
                            <button onclick="loadETFList()" class="search-btn">æœç´¢</button>
                            <button onclick="resetFilters()" class="reset-btn">å…¨éƒ¨</button>
                        </div>
                        
                        <div class="options-section">
                            <label><input type="checkbox" id="onePerIndex">æ¯æŒ‡æ•°ä»…æ˜¾ç¤º1ä¸ªETF</label>
                            <button onclick="selectColumns()" class="select-columns-btn">é€‰æ‹©åˆ—</button>
                        </div>
                    </div>
                    
                    <!-- ETFåˆ—è¡¨ç»“æœ -->
                    <div id="etfListResult" class="result-section etf-table-container"></div>
                </div>
            `;
            showModal('ETFåˆ—è¡¨', content);
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            setTimeout(() => {
                initETFTabEvents();
                loadETFList();
            }, 100);
        }
        
        // åˆå§‹åŒ–ETFæ ‡ç­¾äº‹ä»¶
        function initETFTabEvents() {
            // åˆ†ç±»æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    // æ·»åŠ å½“å‰æ ‡ç­¾æ´»è·ƒçŠ¶æ€
                    this.classList.add('active');
                    // é‡æ–°åŠ è½½æ•°æ®
                    loadETFList();
                });
            });
            
            // å­åˆ†ç±»æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.subcategory-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»è·ƒçŠ¶æ€
                    document.querySelectorAll('.subcategory-tab').forEach(t => t.classList.remove('active'));
                    // æ·»åŠ å½“å‰æ ‡ç­¾æ´»è·ƒçŠ¶æ€
                    this.classList.add('active');
                    // é‡æ–°åŠ è½½æ•°æ®
                    loadETFList();
                });
            });
        }
        
        // é‡ç½®ç­›é€‰æ¡ä»¶
        function resetFilters() {
            document.getElementById('volumeMin').value = '';
            document.getElementById('etfSearch').value = '';
            document.getElementById('onePerIndex').checked = false;
            
            // é‡ç½®æ‰€æœ‰æ ‡ç­¾ä¸ºæ´»è·ƒçŠ¶æ€
            document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.subcategory-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.category-tab[data-category="all"]').classList.add('active');
            document.querySelector('.subcategory-tab[data-subcategory="all"]').classList.add('active');
            
            // é‡æ–°åŠ è½½æ•°æ®
            loadETFList();
        }
        
        // é€‰æ‹©åˆ—åŠŸèƒ½
        function selectColumns() {
            alert('é€‰æ‹©åˆ—åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // å½“å‰é¡µç å’Œé¡µé¢å¤§å°
        let currentPage = 1;
        const pageSize = 20;

        // åŠ è½½ETFåˆ—è¡¨æ•°æ®
        async function loadETFList(page = 1) {
            try {
                // è·å–å½“å‰ç­›é€‰æ¡ä»¶
                const category = document.querySelector('.category-tab.active').dataset.category;
                const subcategory = document.querySelector('.subcategory-tab.active').dataset.subcategory;
                const volumeMin = document.getElementById('volumeMin').value;
                const search = document.getElementById('etfSearch').value;
                const onePerIndex = document.getElementById('onePerIndex').checked;
                
                // æ„å»ºè¯·æ±‚URLï¼ŒåŒ…å«åˆ†é¡µå‚æ•°
                let url = `/api/etf-list?page=${page}&page_size=${pageSize}&`;
                url += `category=${encodeURIComponent(category)}&`;
                url += `subcategory=${encodeURIComponent(subcategory)}&`;
                if (volumeMin) url += `volume_min=${encodeURIComponent(volumeMin)}&`;
                if (search) url += `search=${encodeURIComponent(search)}&`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                let etfs = data.etfs;
                
                // æ¯æŒ‡æ•°ä»…æ˜¾ç¤º1ä¸ªETF
                if (onePerIndex) {
                    const seenIndexes = new Set();
                    etfs = etfs.filter(etf => {
                        if (seenIndexes.has(etf.index_code)) {
                            return false;
                        }
                        seenIndexes.add(etf.index_code);
                        return true;
                    });
                }
                
                // æ›´æ–°å½“å‰é¡µç 
                currentPage = page;
                
                document.getElementById('etfListResult').innerHTML = `
                    <table class="etf-table reference-style">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>è·Ÿè¸ª(æŒ‡æ•°ä»£ç )æŒ‡æ•°åç§°</th>
                                <th>ETFä»£ç </th>
                                <th>ETFåç§°</th>
                                <th>åŸºé‡‘å…¬å¸</th>
                                <th>æœ€æ–°ä»·</th>
                                <th>20æ—¥å‡æˆäº¤é¢[äº¿]</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${etfs.map(etf => `
                                <tr>
                                    <td>${etf.rank}</td>
                                    <td>
                                        <div>${etf.index_code} <span class="index-link">${etf.index_name} ${etf.index_link}</span></div>
                                    </td>
                                    <td>${etf.etf_code}</td>
                                    <td>
                                        <span class="etf-link">${etf.etf_link}</span>
                                    </td>
                                    <td>${etf.fund_company}</td>
                                    <td>${etf.latest_price}</td>
                                    <td>${etf.avg_20d_volume}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <div class="update-time">
                        æ•°æ®æ›´æ–°è‡³: ${data.update_time}
                    </div>
                    <div class="pagination-controls">
                        <button onclick="changePage(${currentPage - 1})" ${currentPage <= 1 ? 'disabled' : ''} id="prev-page">ä¸Šä¸€é¡µ</button>
                        <span id="page-info">ç¬¬ ${currentPage} é¡µï¼Œå…± ${data.pagination.total_pages} é¡µï¼Œæ€»è®¡ ${data.pagination.total} æ¡è®°å½•</span>
                        <button onclick="changePage(${currentPage + 1})" ${currentPage >= data.pagination.total_pages ? 'disabled' : ''} id="next-page">ä¸‹ä¸€é¡µ</button>
                    </div>
                `;
            } catch (error) {
                document.getElementById('etfListResult').innerHTML = `<p class="error">åŠ è½½å¤±è´¥: ${error.message}</p>`;
            }
        }

        // æ”¹å˜é¡µç 
        function changePage(newPage) {
            // è·å–å½“å‰ç­›é€‰æ¡ä»¶
            const totalPages = parseInt(document.querySelector('#page-info').textContent.match(/å…± (\d+) é¡µ/)[1]);
            
            if (newPage < 1 || newPage > totalPages) {
                return; // æ— æ•ˆé¡µç ï¼Œç›´æ¥è¿”å›
            }
            
            loadETFList(newPage);
        }
    </script>
    
    <style>
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border: none;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .tool-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #1a56db;
        }
        
        .calculate-btn {
            background-color: #1a56db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .calculate-btn:hover {
            background-color: #0d3d9c;
        }
        
        .result-section {
            margin-top: 20px;
        }
        
        .result-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        
        .error {
            color: red;
            font-weight: bold;
        }
        
        .valuation-explanation, .status-explanation, .volatility-explanation, 
        .correlation-explanation, .compound-explanation, .irr-explanation {
            margin-top: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        
        .returns-section, .correlation-details, .cash-flows-details, .announcements-list {
            margin-top: 15px;
        }
        
        .calendar-table, .etf-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .calendar-table th, .calendar-table td, .etf-table th, .etf-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .calendar-table th, .etf-table th {
            background-color: #f2f2f2;
        }
        
        .calendar-table .trading_day {
            background-color: #d4edda;
        }
        
        .calendar-table .holiday {
            background-color: #f8d7da;
        }
        
        .etf-table .positive {
            color: green;
        }
        
        .etf-table .negative {
            color: red;
        }
        
        /* ETFåˆ—è¡¨æ ·å¼ */
        .etf-list-tool {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .etf-category-tabs, .etf-subcategory-tabs {
            display: flex;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .category-tab, .subcategory-tab {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 8px 12px;
            margin-right: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }
        
        .category-tab:hover, .subcategory-tab:hover {
            background-color: #e9e9e9;
        }
        
        .category-tab.active, .subcategory-tab.active {
            background-color: #1a56db;
            color: white;
            border-color: #1a56db;
        }
        
        .etf-filter-section {
            display: flex;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .volume-filter, .search-section, .options-section {
            display: flex;
            align-items: center;
        }
        
        .search-btn, .reset-btn, .select-columns-btn {
            background-color: #1a56db;
            color: white;
            border: none;
            padding: 6px 12px;
            margin-right: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .reset-btn {
            background-color: #6c757d;
        }
        
        .select-columns-btn {
            background-color: #28a745;
        }
        
        .etf-table-container {
            margin-top: 20px;
        }
        
        .etf-table.reference-style {
            font-size: 14px;
            border: 1px solid #ddd;
        }
        
        .etf-table.reference-style th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #ddd;
        }
        
        .etf-table.reference-style td {
            border: 1px solid #ddd;
            padding: 6px 8px;
        }
        
        .etf-table.reference-style tr:hover {
            background-color: #f5f5f5;
        }
        
        .index-link {
            color: #1a56db;
            text-decoration: none;
        }
        
        .etf-link {
            color: #1a56db;
            text-decoration: none;
            font-weight: bold;
        }
        
        .update-time {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            text-align: right;
        }
        
        .etf-table.reference-style th:first-child, .etf-table.reference-style td:first-child {
            width: 40px;
            text-align: center;
        }
        
        .etf-table.reference-style th:nth-child(2), .etf-table.reference-style td:nth-child(2) {
            width: 200px;
        }
        
        .etf-table.reference-style th:nth-child(3), .etf-table.reference-style td:nth-child(3),
        .etf-table.reference-style th:nth-child(4), .etf-table.reference-style td:nth-child(4),
        .etf-table.reference-style th:nth-child(5), .etf-table.reference-style td:nth-child(5) {
            width: 120px;
        }
        
        .etf-table.reference-style th:nth-child(6), .etf-table.reference-style td:nth-child(6),
        .etf-table.reference-style th:nth-child(7), .etf-table.reference-style td:nth-child(7) {
            width: 100px;
            text-align: right;
        }
        
        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            gap: 15px;
        }
        
        .pagination-controls button {
            padding: 8px 15px;
            background-color: #1a56db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .pagination-controls button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .pagination-controls #page-info {
            font-size: 14px;
            color: #333;
        }
        
        .announcement-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
    </style>
</body>
</html>