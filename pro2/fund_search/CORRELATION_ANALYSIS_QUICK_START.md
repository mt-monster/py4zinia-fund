# åŸºé‡‘ç›¸å…³æ€§åˆ†æ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“Œ æ ¸å¿ƒæ¦‚å¿µ

**ç›¸å…³æ€§** è¡¡é‡ä¸¤åªåŸºé‡‘ä»·æ ¼å˜åŠ¨çš„åŒæ­¥ç¨‹åº¦ã€‚

### ç›¸å…³ç³»æ•°èŒƒå›´
- **+1.0**ï¼šå®Œå…¨æ­£ç›¸å…³ï¼ˆåŒå‘æ³¢åŠ¨ï¼‰
- **0.0**ï¼šæ— ç›¸å…³æ€§ï¼ˆç‹¬ç«‹æ³¢åŠ¨ï¼‰
- **-1.0**ï¼šå®Œå…¨è´Ÿç›¸å…³ï¼ˆåå‘æ³¢åŠ¨ï¼‰

### æŠ•èµ„æ„ä¹‰
| ç›¸å…³æ€§ | å«ä¹‰ | æŠ•èµ„å»ºè®® |
|--------|------|---------|
| > 0.8 | å¼ºæ­£ç›¸å…³ | âŒ ä¸å»ºè®®åŒæ—¶æŒæœ‰ï¼ˆé£é™©é›†ä¸­ï¼‰ |
| 0.5-0.8 | ä¸­ç­‰æ­£ç›¸å…³ | âš ï¸ å¯é€‚åº¦åˆ†æ•£ |
| 0.2-0.5 | å¼±æ­£ç›¸å…³ | âœ“ é£é™©åˆ†æ•£ä¸€èˆ¬ |
| -0.2-0.2 | æ— ç›¸å…³æ€§ | âœ“âœ“ é£é™©åˆ†æ•£æœ€ä½³ |
| < -0.2 | è´Ÿç›¸å…³ | âœ“âœ“âœ“ é£é™©å¯¹å†²æœ€ä½³ |

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### åŸºæœ¬ç”¨æ³•

```python
from data_retrieval.fund_analyzer import FundAnalyzer

# 1. åˆ›å»ºåˆ†æå™¨
analyzer = FundAnalyzer()

# 2. åˆ†æç›¸å…³æ€§
result = analyzer.analyze_correlation(['110011', '110050', '159934'])

# 3. æŸ¥çœ‹ç»“æœ
print(f"åŸºé‡‘: {result['fund_names']}")
print(f"æ•°æ®ç‚¹: {result['data_points']}")
print(f"ç›¸å…³æ€§çŸ©é˜µ: {result['correlation_matrix']}")
```

### è§£è¯»ç»“æœ

```python
# ç›¸å…³æ€§çŸ©é˜µç¤ºä¾‹
# [[1.0,   0.75, -0.20],
#  [0.75,  1.0,   0.30],
#  [-0.20, 0.30,  1.0]]

# è§£é‡Šï¼š
# - åŸºé‡‘Aå’ŒåŸºé‡‘B: 0.75 (å¼ºæ­£ç›¸å…³ï¼Œä¸å»ºè®®åŒæ—¶æŒæœ‰)
# - åŸºé‡‘Aå’ŒåŸºé‡‘C: -0.20 (å¼±è´Ÿç›¸å…³ï¼Œé£é™©å¯¹å†²)
# - åŸºé‡‘Bå’ŒåŸºé‡‘C: 0.30 (å¼±æ­£ç›¸å…³ï¼Œé£é™©åˆ†æ•£ä¸€èˆ¬)
```

---

## ğŸ“Š å¸¸è§åœºæ™¯

### åœºæ™¯ 1ï¼šæ„å»ºåˆ†æ•£åŒ–æŠ•èµ„ç»„åˆ

**ç›®æ ‡**ï¼šé€‰æ‹©ç›¸å…³æ€§ä½çš„åŸºé‡‘ç»„åˆ

```python
# åˆ†æå€™é€‰åŸºé‡‘
candidates = ['110011', '110050', '159934', '512010', '512480']

# é€å¯¹åˆ†æ
for i in range(len(candidates)):
    for j in range(i+1, len(candidates)):
        result = analyzer.analyze_correlation([candidates[i], candidates[j]])
        r = result['correlation_matrix'][0][1]
        
        if r < 0.3:  # ç›¸å…³æ€§ä½
            print(f"âœ“ {result['fund_names'][0]} + {result['fund_names'][1]}: {r:.2f}")
        else:
            print(f"âœ— {result['fund_names'][0]} + {result['fund_names'][1]}: {r:.2f}")
```

### åœºæ™¯ 2ï¼šè¯„ä¼°æŠ•èµ„ç»„åˆé£é™©

**ç›®æ ‡**ï¼šæ£€æŸ¥ç°æœ‰æŒä»“çš„ç›¸å…³æ€§

```python
# æ£€æŸ¥ç°æœ‰æŒä»“
holdings = ['110011', '110050', '159934']
result = analyzer.analyze_correlation(holdings)

# è®¡ç®—å¹³å‡ç›¸å…³æ€§
import numpy as np
matrix = np.array(result['correlation_matrix'])
off_diag = matrix[np.triu_indices_from(matrix, k=1)]
avg_corr = np.mean(off_diag)

if avg_corr > 0.7:
    print("âš ï¸ é£é™©é›†ä¸­ï¼Œå»ºè®®è°ƒæ•´")
elif avg_corr < 0.3:
    print("âœ“ é£é™©åˆ†æ•£è‰¯å¥½")
else:
    print("âš ï¸ é£é™©åˆ†æ•£ä¸€èˆ¬")
```

### åœºæ™¯ 3ï¼šå¯¹å†²é£é™©

**ç›®æ ‡**ï¼šæ‰¾åˆ°è´Ÿç›¸å…³çš„åŸºé‡‘è¿›è¡Œå¯¹å†²

```python
# å¯»æ‰¾è´Ÿç›¸å…³åŸºé‡‘
result = analyzer.analyze_correlation(['110011', '159934'])
r = result['correlation_matrix'][0][1]

if r < -0.2:
    print(f"âœ“ å¯ç”¨äºå¯¹å†² (ç›¸å…³æ€§: {r:.2f})")
else:
    print(f"âœ— å¯¹å†²æ•ˆæœä¸ä½³ (ç›¸å…³æ€§: {r:.2f})")
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç›¸å…³æ€§çŸ©é˜µæ˜¯å¯¹ç§°çš„ï¼Ÿ

**A**: å› ä¸ºç›¸å…³æ€§æ˜¯å¯¹ç§°çš„ã€‚åŸºé‡‘Aä¸åŸºé‡‘Bçš„ç›¸å…³æ€§ç­‰äºåŸºé‡‘Bä¸åŸºé‡‘Açš„ç›¸å…³æ€§ã€‚

```
çŸ©é˜µç¤ºä¾‹ï¼š
     A    B    C
A  [1.0  0.75 -0.20]
B  [0.75 1.0  0.30]
C  [-0.20 0.30 1.0]

å¯¹è§’çº¿ä¸º1ï¼ˆåŸºé‡‘ä¸è‡ªèº«çš„ç›¸å…³æ€§ï¼‰
```

### Q2: æ•°æ®ç‚¹æ•°è¶Šå¤šè¶Šå¥½å—ï¼Ÿ

**A**: æ˜¯çš„ã€‚æ›´å¤šæ•°æ®ç‚¹æ„å‘³ç€ï¼š
- æ›´å‡†ç¡®çš„ç›¸å…³æ€§è®¡ç®—
- æ›´èƒ½ä»£è¡¨é•¿æœŸè¶‹åŠ¿
- å‡å°‘çŸ­æœŸæ³¢åŠ¨çš„å½±å“

**å»ºè®®**ï¼šè‡³å°‘ä½¿ç”¨30ä¸ªæ•°æ®ç‚¹ï¼ˆçº¦1ä¸ªæœˆï¼‰

### Q3: ç›¸å…³æ€§ä¼šå˜åŒ–å—ï¼Ÿ

**A**: æ˜¯çš„ã€‚ç›¸å…³æ€§ä¼šéšæ—¶é—´å˜åŒ–ï¼š
- çŸ­æœŸï¼ˆ1ä¸ªæœˆï¼‰ï¼šæ³¢åŠ¨è¾ƒå¤§
- ä¸­æœŸï¼ˆ3-6ä¸ªæœˆï¼‰ï¼šç›¸å¯¹ç¨³å®š
- é•¿æœŸï¼ˆ1å¹´ä»¥ä¸Šï¼‰ï¼šè¶‹åŠ¿æ˜æ˜¾

**å»ºè®®**ï¼šå®šæœŸæ›´æ–°ç›¸å…³æ€§åˆ†æï¼ˆæ¯æœˆæˆ–æ¯å­£åº¦ï¼‰

### Q4: å¦‚ä½•å¤„ç†ç¼ºå¤±æ•°æ®ï¼Ÿ

**A**: ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼š
- ä½¿ç”¨å‰å‘å¡«å……ï¼ˆForward Fillï¼‰
- ä½¿ç”¨åå‘å¡«å……ï¼ˆBackward Fillï¼‰
- ç§»é™¤å¼‚å¸¸å€¼ï¼ˆæ”¶ç›Šç‡ > Â±100%ï¼‰

### Q5: ç›¸å…³æ€§ä¸ºä»€ä¹ˆæœ‰æ—¶æ˜¯NaNï¼Ÿ

**A**: å¯èƒ½åŸå› ï¼š
- æ•°æ®ä¸è¶³ï¼ˆ< 30ä¸ªæ•°æ®ç‚¹ï¼‰
- åŸºé‡‘åœç‰Œæˆ–æ— äº¤æ˜“
- æ•°æ®è´¨é‡é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥å¤±è´¥åˆ—è¡¨ `result['failed_codes']`

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸæ›´æ–°åˆ†æ
```python
# æ¯æœˆæ›´æ–°ä¸€æ¬¡
from datetime import datetime, timedelta

last_update = datetime.now() - timedelta(days=30)
if datetime.now() > last_update:
    result = analyzer.analyze_correlation(holdings)
```

### 2. ä½¿ç”¨ç¼“å­˜æé«˜æ€§èƒ½
```python
# å¯ç”¨ç¼“å­˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
analyzer = FundAnalyzer(enable_cache=True)

# ç›¸åŒçš„åˆ†æä¼šä½¿ç”¨ç¼“å­˜ç»“æœï¼ˆ24å°æ—¶æœ‰æ•ˆï¼‰
result1 = analyzer.analyze_correlation(['110011', '110050'])
result2 = analyzer.analyze_correlation(['110011', '110050'])  # ä½¿ç”¨ç¼“å­˜
```

### 3. éªŒè¯æ•°æ®è´¨é‡
```python
result = analyzer.analyze_correlation(fund_codes)

# æ£€æŸ¥å¤±è´¥çš„åŸºé‡‘
if result['failed_codes']:
    print(f"âš ï¸ {len(result['failed_codes'])} åªåŸºé‡‘å¤±è´¥:")
    for code, reason in result['failed_codes']:
        print(f"  - {code}: {reason}")

# æ£€æŸ¥æ•°æ®ç‚¹æ•°
if result['data_points'] < 100:
    print(f"âš ï¸ æ•°æ®ç‚¹è¾ƒå°‘ ({result['data_points']})")
```

### 4. å¤šè§’åº¦åˆ†æ
```python
# ä¸ä»…çœ‹ç›¸å…³æ€§ï¼Œè¿˜è¦çœ‹å…¶ä»–æŒ‡æ ‡
result = analyzer.analyze_correlation(holdings)

# è®¡ç®—åˆ†æ•£åº¦è¯„åˆ†
import numpy as np
matrix = np.array(result['correlation_matrix'])
off_diag = matrix[np.triu_indices_from(matrix, k=1)]
diversification_score = 1 - np.mean(np.abs(off_diag))

print(f"åˆ†æ•£åº¦è¯„åˆ†: {diversification_score:.2f} (0-1, è¶Šé«˜è¶Šå¥½)")
```

---

## ğŸ“ˆ å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šè‚¡ç¥¨å‹åŸºé‡‘ç»„åˆ

```python
# åˆ†æä¸‰åªè‚¡ç¥¨å‹åŸºé‡‘
result = analyzer.analyze_correlation(['110011', '110050', '162605'])

# é¢„æœŸç»“æœï¼šç›¸å…³æ€§è¾ƒé«˜ (0.6-0.8)
# åŸå› ï¼šéƒ½æ˜¯è‚¡ç¥¨å‹åŸºé‡‘ï¼Œè·Ÿè¸ªç›¸ä¼¼çš„å¸‚åœº
# å»ºè®®ï¼šä¸å»ºè®®åŒæ—¶æŒæœ‰ï¼Œé€‰æ‹©å…¶ä¸­ä¸€åª
```

### æ¡ˆä¾‹ 2ï¼šæ··åˆå‹åŸºé‡‘ç»„åˆ

```python
# åˆ†ææ··åˆå‹å’Œè‚¡ç¥¨å‹åŸºé‡‘
result = analyzer.analyze_correlation(['110011', '519674', '519674'])

# é¢„æœŸç»“æœï¼šç›¸å…³æ€§ä¸­ç­‰ (0.4-0.6)
# åŸå› ï¼šæ··åˆå‹åŸºé‡‘é£é™©è¾ƒä½ï¼Œä¸è‚¡ç¥¨å‹åŸºé‡‘æœ‰å·®å¼‚
# å»ºè®®ï¼šå¯ä»¥é€‚åº¦åˆ†æ•£
```

### æ¡ˆä¾‹ 3ï¼šè¡Œä¸šåŸºé‡‘ç»„åˆ

```python
# åˆ†æä¸åŒè¡Œä¸šçš„ETF
result = analyzer.analyze_correlation(['159928', '512010', '512480', '515030'])

# é¢„æœŸç»“æœï¼šç›¸å…³æ€§è¾ƒä½ (0.2-0.5)
# åŸå› ï¼šä¸åŒè¡Œä¸šåŸºé‡‘é£é™©åˆ†æ•£æ•ˆæœå¥½
# å»ºè®®ï¼šå¯ä»¥åŒæ—¶æŒæœ‰ï¼Œé£é™©åˆ†æ•£æ•ˆæœæœ€ä½³
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šè·å–æ•°æ®å¤±è´¥

```
é”™è¯¯: æœ‰æ•ˆåŸºé‡‘æ•°æ®ä¸è¶³2åªï¼Œå¤±è´¥åˆ—è¡¨: [('999999', 'æ— å†å²æ•°æ®')]
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥åŸºé‡‘ä»£ç æ˜¯å¦æ­£ç¡®
- ç¡®ä¿åŸºé‡‘æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®
- å°è¯•ä½¿ç”¨å…¶ä»–åŸºé‡‘ä»£ç 

### é—®é¢˜ 2ï¼šæ•°æ®ç‚¹ä¸è¶³

```
é”™è¯¯: åˆå¹¶åæ•°æ®ä¸è¶³: 5 < 30
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¢åŠ åˆ†ææ—¶é—´èŒƒå›´ï¼ˆä»365å¤©æ”¹ä¸ºæ›´é•¿ï¼‰
- é€‰æ‹©å†å²æ•°æ®æ›´å®Œæ•´çš„åŸºé‡‘
- æ£€æŸ¥åŸºé‡‘æ˜¯å¦æ–°æˆç«‹

### é—®é¢˜ 3ï¼šç›¸å…³æ€§å¼‚å¸¸

```
ç›¸å…³æ€§çŸ©é˜µä¸­å‡ºç°NaNå€¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥åŸºé‡‘æ•°æ®è´¨é‡
- å¢åŠ æœ€å°‘æ•°æ®ç‚¹æ•°è¦æ±‚
- æŸ¥çœ‹å¤±è´¥åˆ—è¡¨äº†è§£å…·ä½“åŸå› 

---

## ğŸ“š ç›¸å…³èµ„æº

- [Pearson ç›¸å…³ç³»æ•°](https://en.wikipedia.org/wiki/Pearson_correlation_coefficient)
- [ç°ä»£æŠ•èµ„ç»„åˆç†è®º](https://en.wikipedia.org/wiki/Modern_portfolio_theory)
- [åŸºé‡‘åˆ†æ•£åŒ–æŠ•èµ„](https://www.investopedia.com/terms/d/diversification.asp)

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. `README_CORRELATION_ANALYSIS.md` - è¯¦ç»†æ–‡æ¡£
2. `test_correlation_analysis_improved.py` - æµ‹è¯•ç¤ºä¾‹
3. ä»£ç æ³¨é‡Šå’Œæ—¥å¿—è¾“å‡º

