<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤æ˜“è¯¦æƒ…åŠŸèƒ½æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">äº¤æ˜“è¯¦æƒ…åŠŸèƒ½æµ‹è¯•</h2>
        
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">äº¤æ˜“è®°å½•è¡¨æ ¼ç¤ºä¾‹</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>æ—¥æœŸ</th>
                                <th>æ“ä½œ</th>
                                <th>é‡‘é¢</th>
                                <th>ä½™é¢</th>
                                <th>æŒä»“</th>
                                <th>å€æ•°</th>
                                <th>è¶‹åŠ¿</th>
                                <th>ä¼˜åŒ–æŒ‡æ ‡</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2024-01-15</td>
                                <td class="positive">ä¹°å…¥</td>
                                <td>Â¥10,000.00</td>
                                <td>Â¥85,000.00</td>
                                <td>Â¥115,000.00</td>
                                <td>1.2Ã—</td>
                                <td>ğŸ“ˆ</td>
                                <td class="text-center">ğŸ”´ ğŸ“Š</td>
                                <td class="text-center">
                                    <button class="btn btn-outline-primary btn-sm trade-detail-btn" 
                                            data-trade='{"date":"2024-01-15","action":"buy","amount":10000,"balance":85000,"holdings":115000,"multiplier":1.2,"trend":"uptrend","adx_value":45.6,"market_adjusted":true}'
                                            onclick="showTradeDetail(this)">
                                        <i class="bi bi-eye"></i> è¯¦æƒ…
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>2024-01-20</td>
                                <td class="negative">å–å‡º</td>
                                <td>Â¥8,500.00</td>
                                <td>Â¥93,500.00</td>
                                <td>Â¥106,500.00</td>
                                <td>1.0Ã—</td>
                                <td>ğŸ“‰</td>
                                <td class="text-center">ğŸŸ¡ ğŸ“ˆ</td>
                                <td class="text-center">
                                    <button class="btn btn-outline-primary btn-sm trade-detail-btn" 
                                            data-trade='{"date":"2024-01-20","action":"sell","amount":8500,"balance":93500,"holdings":106500,"multiplier":1.0,"trend":"downtrend","adx_value":28.3,"volume_confirmed":true}'
                                            onclick="showTradeDetail(this)">
                                        <i class="bi bi-eye"></i> è¯¦æƒ…
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>2024-02-01</td>
                                <td class="text-danger fw-bold">æ­¢æŸ</td>
                                <td>Â¥12,000.00</td>
                                <td>Â¥81,500.00</td>
                                <td>Â¥94,500.00</td>
                                <td>1.5Ã—</td>
                                <td>â¡ï¸</td>
                                <td class="text-center">ğŸš«</td>
                                <td class="text-center">
                                    <button class="btn btn-outline-primary btn-sm trade-detail-btn" 
                                            data-trade='{"date":"2024-02-01","action":"stop_loss","amount":12000,"balance":81500,"holdings":94500,"multiplier":1.5,"trend":"sideways","trend_filtered":true}'
                                            onclick="showTradeDetail(this)">
                                        <i class="bi bi-eye"></i> è¯¦æƒ…
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        /**
         * æ˜¾ç¤ºäº¤æ˜“è¯¦æƒ…å¼¹çª—
         * @param {HTMLElement} button - è§¦å‘æŒ‰é’®å…ƒç´ 
         */
        function showTradeDetail(button) {
            // è·å–äº¤æ˜“æ•°æ®
            const tradeData = JSON.parse(button.getAttribute('data-trade'));
            
            // æ„å»ºè¯¦æƒ…HTML
            const detailHtml = `
                <div class="modal fade" id="tradeDetailModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-receipt me-2"></i>äº¤æ˜“è¯¦æƒ…
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="detail-card">
                                            <h6 class="detail-title"><i class="bi bi-calendar me-2"></i>åŸºæœ¬ä¿¡æ¯</h6>
                                            <div class="detail-item">
                                                <span class="detail-label">äº¤æ˜“æ—¥æœŸ:</span>
                                                <span class="detail-value">${tradeData.date}</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">äº¤æ˜“ç±»å‹:</span>
                                                <span class="detail-value">
                                                    <span class="badge ${tradeData.action === 'buy' ? 'bg-success' : 'bg-danger'}">
                                                        ${tradeData.action === 'buy' ? 'ä¹°å…¥' : tradeData.action === 'stop_loss' ? 'æ­¢æŸ' : 'å–å‡º'}
                                                    </span>
                                                </span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">äº¤æ˜“é‡‘é¢:</span>
                                                <span class="detail-value">Â¥${tradeData.amount.toFixed(2)}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="detail-card">
                                            <h6 class="detail-title"><i class="bi bi-wallet2 me-2"></i>è´¦æˆ·çŠ¶æ€</h6>
                                            <div class="detail-item">
                                                <span class="detail-label">äº¤æ˜“åä½™é¢:</span>
                                                <span class="detail-value">Â¥${tradeData.balance.toFixed(2)}</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">æŒä»“ä»·å€¼:</span>
                                                <span class="detail-value">Â¥${tradeData.holdings.toFixed(2)}</span>
                                            </div>
                                            <div class="detail-item">
                                                <span class="detail-label">æ æ†å€æ•°:</span>
                                                <span class="detail-value">${tradeData.multiplier ? tradeData.multiplier.toFixed(2) + 'Ã—' : 'æ— '}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                ${(tradeData.trend || tradeData.adx_value !== undefined || tradeData.market_adjusted || tradeData.volume_confirmed || tradeData.trend_filtered) ? `
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <div class="detail-card">
                                            <h6 class="detail-title"><i class="bi bi-gear me-2"></i>ç­–ç•¥æŒ‡æ ‡</h6>
                                            ${tradeData.trend ? `
                                            <div class="detail-item">
                                                <span class="detail-label">å¸‚åœºè¶‹åŠ¿:</span>
                                                <span class="detail-value">
                                                    ${tradeData.trend === 'uptrend' ? 'ğŸ“ˆ ä¸Šå‡è¶‹åŠ¿' : 
                                                      tradeData.trend === 'downtrend' ? 'ğŸ“‰ ä¸‹é™è¶‹åŠ¿' : 
                                                      'â¡ï¸ éœ‡è¡è¶‹åŠ¿'}
                                                </span>
                                            </div>
                                            ` : ''}
                                            ${tradeData.adx_value !== undefined ? `
                                            <div class="detail-item">
                                                <span class="detail-label">ADXå€¼:</span>
                                                <span class="detail-value">
                                                    <span class="badge ${tradeData.adx_value > 40 ? 'bg-danger' : tradeData.adx_value > 25 ? 'bg-warning text-dark' : tradeData.adx_value > 15 ? 'bg-info' : 'bg-secondary'}">
                                                        ${tradeData.adx_value.toFixed(2)}
                                                        ${tradeData.adx_value > 40 ? '(å¼ºè¶‹åŠ¿)' : 
                                                          tradeData.adx_value > 25 ? '(ä¸­ç­‰è¶‹åŠ¿)' : 
                                                          tradeData.adx_value > 15 ? '(å¼±è¶‹åŠ¿)' : '(æ— è¶‹åŠ¿)'}
                                                    </span>
                                                </span>
                                            </div>
                                            ` : ''}
                                            ${tradeData.market_adjusted ? `
                                            <div class="detail-item">
                                                <span class="detail-label">å¸‚åœºè°ƒæ•´:</span>
                                                <span class="detail-value text-success">å·²åº”ç”¨</span>
                                            </div>
                                            ` : ''}
                                            ${tradeData.volume_confirmed ? `
                                            <div class="detail-item">
                                                <span class="detail-label">æˆäº¤é‡ç¡®è®¤:</span>
                                                <span class="detail-value text-success">å·²ç¡®è®¤</span>
                                            </div>
                                            ` : ''}
                                            ${tradeData.trend_filtered ? `
                                            <div class="detail-item">
                                                <span class="detail-label">è¶‹åŠ¿è¿‡æ»¤:</span>
                                                <span class="detail-value text-warning">å·²è§¦å‘</span>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                <div class="mt-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading"><i class="bi bi-info-circle me-2"></i>äº¤æ˜“è¯´æ˜</h6>
                                        <p class="mb-0">
                                            ${tradeData.action === 'buy' ? 'æœ¬æ¬¡ä¹°å…¥æ“ä½œåŸºäºç­–ç•¥ä¿¡å·æ‰§è¡Œï¼Œå¢åŠ äº†ç›¸åº”æŒä»“ã€‚' : 
                                              tradeData.action === 'stop_loss' ? 'æœ¬æ¬¡æ­¢æŸæ“ä½œæ—¨åœ¨æ§åˆ¶é£é™©ï¼ŒåŠæ—¶æ­¢æŸã€‚' : 
                                              'æœ¬æ¬¡å–å‡ºæ“ä½œåŸºäºç­–ç•¥ä¿¡å·æ‰§è¡Œï¼Œå‡å°‘äº†ç›¸åº”æŒä»“ã€‚'}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                                <button type="button" class="btn btn-primary" onclick="exportTradeDetail(${JSON.stringify(tradeData).replace(/"/g, '&quot;')})">
                                    <i class="bi bi-download me-2"></i>å¯¼å‡ºè¯¦æƒ…
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ç§»é™¤å·²å­˜åœ¨çš„æ¨¡æ€æ¡†
            const existingDetailModal = document.getElementById('tradeDetailModal');
            if (existingDetailModal) {
                existingDetailModal.remove();
            }
            
            // æ·»åŠ æ–°çš„æ¨¡æ€æ¡†åˆ°é¡µé¢
            document.body.insertAdjacentHTML('beforeend', detailHtml);
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            const detailModal = new bootstrap.Modal(document.getElementById('tradeDetailModal'));
            detailModal.show();
        }
        
        /**
         * å¯¼å‡ºäº¤æ˜“è¯¦æƒ…
         * @param {Object} tradeData - äº¤æ˜“æ•°æ®
         */
        function exportTradeDetail(tradeData) {
            // åˆ›å»ºCSVå†…å®¹
            const csvContent = [
                ['å­—æ®µ', 'å€¼'],
                ['äº¤æ˜“æ—¥æœŸ', tradeData.date],
                ['äº¤æ˜“ç±»å‹', tradeData.action === 'buy' ? 'ä¹°å…¥' : tradeData.action === 'stop_loss' ? 'æ­¢æŸ' : 'å–å‡º'],
                ['äº¤æ˜“é‡‘é¢', `Â¥${tradeData.amount.toFixed(2)}`],
                ['äº¤æ˜“åä½™é¢', `Â¥${tradeData.balance.toFixed(2)}`],
                ['æŒä»“ä»·å€¼', `Â¥${tradeData.holdings.toFixed(2)}`],
                ['æ æ†å€æ•°', tradeData.multiplier ? `${tradeData.multiplier.toFixed(2)}Ã—` : 'æ— '],
                ['å¸‚åœºè¶‹åŠ¿', tradeData.trend || 'æœªè®°å½•'],
                ['ADXå€¼', tradeData.adx_value !== undefined ? tradeData.adx_value.toFixed(2) : 'æœªè®°å½•'],
                ['å¸‚åœºè°ƒæ•´', tradeData.market_adjusted ? 'æ˜¯' : 'å¦'],
                ['æˆäº¤é‡ç¡®è®¤', tradeData.volume_confirmed ? 'æ˜¯' : 'å¦'],
                ['è¶‹åŠ¿è¿‡æ»¤', tradeData.trend_filtered ? 'æ˜¯' : 'å¦']
            ].map(row => row.join(',')).join('\n');
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `äº¤æ˜“è¯¦æƒ…_${tradeData.date}_${tradeData.action}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // æ˜¾ç¤ºæç¤º
            alert('äº¤æ˜“è¯¦æƒ…å·²å¯¼å‡ºï¼');
        }
    </script>
    
    <style>
        /* äº¤æ˜“è¯¦æƒ…æŒ‰é’®æ ·å¼ */
        .trade-detail-btn {
            padding: 4px 12px;
            font-size: 12px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        
        .trade-detail-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* äº¤æ˜“è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .detail-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #e9ecef;
        }
        
        .detail-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #0d6efd;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 0;
            border-bottom: 1px dashed #dee2e6;
        }
        
        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .detail-label {
            font-weight: 500;
            color: #6c757d;
        }
        
        .detail-value {
            font-weight: 600;
            color: #212529;
        }
        
        .positive { color: #198754; }
        .negative { color: #dc3545; }
    </style>
</body>
</html>