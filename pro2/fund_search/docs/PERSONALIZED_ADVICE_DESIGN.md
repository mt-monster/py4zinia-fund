# ä¸ªæ€§åŒ–æŠ•èµ„å»ºè®®åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°
ä¸ºæ¯åªåŸºé‡‘æ ¹æ®åŽ†å²æ•°æ®ã€é£Žé™©ç‰¹å¾ã€æ”¶ç›Šæ¨¡å¼ç­‰ï¼Œä»Žç­–ç•¥åº“ä¸­è‡ªåŠ¨åŒ¹é…æœ€ä¼˜ç­–ç•¥ï¼Œç”Ÿæˆä¸ªæ€§åŒ–æŠ•èµ„å»ºè®®ã€‚

## æž¶æž„è®¾è®¡

### 1. ç­–ç•¥é€‰æ‹©å™¨ (StrategySelector)

**æ–‡ä»¶**: `backtesting/strategy_selector.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- **åŸºé‡‘ç”»åƒåˆ†æž**: è®¡ç®—æ³¢åŠ¨çŽ‡ã€è¶‹åŠ¿å¼ºåº¦ã€å‡å€¼å›žå½’ç‰¹å¾ã€å¤æ™®æ¯”çŽ‡ã€æœ€å¤§å›žæ’¤ç­‰
- **ç­–ç•¥åŒ¹é…è¯„åˆ†**: æ ¹æ®åŸºé‡‘ç‰¹å¾è¯„ä¼°ä¸Žæ¯ç§ç­–ç•¥çš„åŒ¹é…åº¦
- **æœ€ä¼˜ç­–ç•¥é€‰æ‹©**: é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç­–ç•¥

**ç­–ç•¥åº“**:
| ç­–ç•¥ | é€‚ç”¨åœºæ™¯ | åŒ¹é…ç‰¹å¾ |
|------|---------|---------|
| åŒå‡çº¿åŠ¨é‡ç­–ç•¥ (dual_ma) | è¶‹åŠ¿åž‹åŸºé‡‘ | è¶‹åŠ¿å¼ºåº¦>0.3, å¤æ™®æ¯”çŽ‡>0.5 |
| å‡å€¼å›žå½’ç­–ç•¥ (mean_reversion) | éœ‡è¡åž‹åŸºé‡‘ | å‡å€¼å›žå½’ç‰¹å¾>0.3, æ³¢åŠ¨é€‚ä¸­ |
| ç½‘æ ¼äº¤æ˜“ç­–ç•¥ (grid_trading) | é«˜æ³¢åŠ¨éœ‡è¡ | æ³¢åŠ¨çŽ‡>0.25, è¶‹åŠ¿å¼ºåº¦<0.3 |
| ç›®æ ‡å¸‚å€¼ç­–ç•¥ (target_value) | å®šæŠ•è®¡åˆ’ | æ³¢åŠ¨çŽ‡<0.20, å›žæ’¤å¯æŽ§ |
| å¢žå¼ºè§„åˆ™ç­–ç•¥ (enhanced_rule) | é€šç”¨åž‹ | é€‚åº”å„ç§å¸‚åœºçŽ¯å¢ƒ |

### 2. ä¸ªæ€§åŒ–å»ºè®®API

**ç«¯ç‚¹**: `POST /api/holdings/analyze/personalized-advice`

**è¯·æ±‚ä½“**:
```json
{
    "fund_codes": ["000001", "110022", "..."]
}
```

**å“åº”ç»“æž„**:
```json
{
    "success": true,
    "funds": [
        {
            "fund_code": "000001",
            "fund_name": "æŸæŸåŸºé‡‘",
            "today_return": 0.18,
            "prev_day_return": 0.24,
            "optimal_strategy": {
                "name": "åŒå‡çº¿åŠ¨é‡ç­–ç•¥",
                "type": "dual_ma",
                "match_score": 85.5,
                "selection_reason": "è¶‹åŠ¿æ˜Žæ˜¾...",
                "backtest_score": 70.0
            },
            "fund_profile": {
                "volatility": 0.25,
                "trend_strength": 0.6,
                "mean_reversion_score": 0.2,
                "sharpe_ratio": 1.5,
                "max_drawdown": -15.0,
                "risk_level": "medium"
            },
            "advice": {
                "action": "buy",
                "amount_multiplier": 1.5,
                "reason": "é‡‘å‰è¶‹åŠ¿ä¸­",
                "description": "çŸ­æœŸå‡çº¿ä½äºŽé•¿æœŸå‡çº¿ä¸Šæ–¹",
                "status_label": "ðŸŸ¢ é‡‘å‰è¶‹åŠ¿",
                "operation_suggestion": "ç§¯æžä¹°å…¥(1.5Ã—å®šæŠ•é¢)",
                "execution_amount": "ä¹°å…¥1.5Ã—åŸºç¡€å®šæŠ•é¢"
            },
            "all_strategies_comparison": [...]
        }
    ],
    "summary": {
        "total_count": 5,
        "buy_count": 2,
        "sell_count": 1,
        "hold_count": 2,
        "strategy_distribution": {
            "dual_ma": 2,
            "mean_reversion": 1,
            "enhanced_rule": 2
        },
        "analysis_date": "2026-02-12 10:30",
        "is_personalized": true
    }
}
```

### 3. å‰ç«¯å±•ç¤º

**æ–‡ä»¶**: `web/templates/investment_advice.html`

**UIç»„ä»¶**:

1. **ç­–ç•¥åŒ¹é…åº¦å¡ç‰‡**
   - æ˜¾ç¤ºå¹³å‡ç­–ç•¥åŒ¹é…åº¦ç™¾åˆ†æ¯”
   - æ“ä½œåˆ†å¸ƒç»Ÿè®¡ï¼ˆä¹°å…¥/å–å‡º/æŒæœ‰ï¼‰
   - æ ¸å¿ƒæŠ•èµ„å»ºè®®æ‘˜è¦

2. **ä¸ªæ€§åŒ–ç­–ç•¥è¡¨æ ¼**
   - åŸºé‡‘ä»£ç å’Œåç§°
   - æœ€ä¼˜ç­–ç•¥ç±»åž‹å’Œåç§°
   - ç­–ç•¥é€‰æ‹©ç†ç”±
   - åŒ¹é…åº¦è¿›åº¦æ¡
   - ä»Šæ—¥æ”¶ç›ŠçŽ‡
   - æ“ä½œå»ºè®®

3. **ç­–ç•¥åˆ†å¸ƒç»Ÿè®¡**
   - æ˜¾ç¤ºå„ç±»ç­–ç•¥çš„ä½¿ç”¨æ•°é‡
   - é¥¼å›¾æˆ–åˆ—è¡¨å±•ç¤º

**å…³é”®æ ·å¼**:
- åŒ¹é…åº¦è¿›åº¦æ¡
- é£Žé™©ç­‰çº§æ ‡ç­¾ï¼ˆé«˜/ä¸­/ä½Žï¼‰
- æ“ä½œç±»åž‹æ ‡ç­¾ï¼ˆä¹°å…¥/å–å‡º/æŒæœ‰ï¼‰
- ç­–ç•¥é€‰æ‹©ç†ç”±tooltip

## æ ¸å¿ƒç®—æ³•

### ç­–ç•¥åŒ¹é…è¯„åˆ†ç®—æ³•

```python
def _evaluate_strategy_fit(strategy, profile, strategy_key):
    score = 50.0  # åŸºç¡€åˆ†
    
    # 1. æ³¢åŠ¨çŽ‡åŒ¹é… (Â±20åˆ†)
    if min_vol <= profile.volatility <= max_vol:
        score += 20
    else:
        score -= 10
    
    # 2. ç‰¹å¾åŒ¹é… (Â±20åˆ†)
    if isinstance(strategy, DualMAStrategy):
        if abs(profile.trend_strength) > 0.3:
            score += 20
    elif isinstance(strategy, MeanReversionStrategy):
        if profile.mean_reversion_score > 0.3:
            score += 20
    
    # 3. é£Žé™©è°ƒæ•´ (Â±10åˆ†)
    if profile.sharpe_ratio < 0:
        score -= 10
    if profile.max_drawdown < -30:
        score -= 10
    
    return min(max(score, 0), 100)
```

### åŸºé‡‘ç‰¹å¾è®¡ç®—

1. **å¹´åŒ–æ³¢åŠ¨çŽ‡**: `std(æ—¥æ”¶ç›ŠçŽ‡) Ã— âˆš252`
2. **è¶‹åŠ¿å¼ºåº¦**: `(MA20 - MA60) / MA60`
3. **å‡å€¼å›žå½’åˆ†æ•°**: `-correlation(åç¦»åº¦, æœªæ¥æ”¶ç›ŠçŽ‡)`
4. **å¤æ™®æ¯”çŽ‡**: `(å¹³å‡æ”¶ç›ŠçŽ‡ - æ— é£Žé™©åˆ©çŽ‡) / æ ‡å‡†å·®`

## ä½¿ç”¨æµç¨‹

1. **ç”¨æˆ·åœ¨æŒä»“é¡µé¢é€‰æ‹©åŸºé‡‘**
2. **ç‚¹å‡»"æŠ•èµ„å»ºè®®"æŒ‰é’®**
3. **å‰ç«¯è°ƒç”¨ä¸ªæ€§åŒ–å»ºè®®API**
4. **åŽç«¯ä¸ºæ¯åªåŸºé‡‘**:
   - èŽ·å–åŽ†å²æ•°æ®
   - åˆ†æžåŸºé‡‘ç‰¹å¾
   - åŒ¹é…æœ€ä¼˜ç­–ç•¥
   - ç”Ÿæˆå½“å‰å»ºè®®
5. **å‰ç«¯å±•ç¤ºä¸ªæ€§åŒ–åˆ†æžç»“æžœ**

## ä¼˜åŠ¿

1. **ä¸ªæ€§åŒ–**: æ¯åªåŸºé‡‘æœ‰ç‹¬ç«‹çš„ç­–ç•¥åŒ¹é…
2. **é€æ˜Ž**: æ˜¾ç¤ºç­–ç•¥é€‰æ‹©ç†ç”±å’ŒåŒ¹é…åº¦
3. **ä¸“ä¸š**: åŸºäºŽ5ç§ç»å…¸ç­–ç•¥æ¨¡åž‹
4. **å¯è§†åŒ–**: åŒ¹é…åº¦ã€é£Žé™©ç­‰çº§ä¸€ç›®äº†ç„¶
5. **å¯æ¯”**: å¯æŸ¥çœ‹æ‰€æœ‰ç­–ç•¥çš„å¯¹æ¯”ç»“æžœ

## æœªæ¥æ‰©å±•

1. **ç­–ç•¥å›žæµ‹è¯„åˆ†**: åœ¨åŽ†å²æ•°æ®ä¸Šå›žæµ‹å„ç­–ç•¥è¡¨çŽ°
2. **æœºå™¨å­¦ä¹ æŽ¨è**: ä½¿ç”¨MLé¢„æµ‹æœ€ä¼˜ç­–ç•¥
3. **ç”¨æˆ·åå¥½å­¦ä¹ **: æ ¹æ®ç”¨æˆ·æ“ä½œä¹ æƒ¯è°ƒæ•´æŽ¨è
4. **ç»„åˆä¼˜åŒ–**: è€ƒè™‘åŸºé‡‘é—´çš„ç›¸å…³æ€§è¿›è¡Œç»„åˆç­–ç•¥åŒ¹é…
