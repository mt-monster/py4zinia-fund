# QDII基金数据获取说明

## 概述

QDII（Qualified Domestic Institutional Investor，合格境内机构投资者）基金是指在中国境内设立，经中国证监会批准从事境外证券市场的股票、债券等有价证券投资的基金。

## 测试基金信息

- **基金代码**: 006105
- **基金名称**: 国富全球科技互联混合(QDII)人民币
- **基金类型**: QDII混合型基金
- **投资范围**: 全球科技互联网相关股票

## QDII基金特点

### 1. 交易规则
- **确认时间**: T+2 确认（比普通基金多1天）
- **赎回到账**: 通常需要 7-10 个工作日（比普通基金长）
- **申购限制**: 部分QDII基金可能有额度限制

### 2. 计价货币
- **人民币份额**: 以人民币计价和交易
- **美元份额**: 部分QDII基金提供美元份额
- **汇率影响**: 净值受汇率波动影响

### 3. 净值更新
- **更新时间**: 受海外市场交易时间影响
- **时差因素**: 可能比国内基金晚1-2天更新
- **节假日**: 受境内外双重节假日影响

### 4. 投资范围
- **美股市场**: 纳斯达克、纽交所等
- **港股市场**: 香港联交所
- **其他市场**: 欧洲、日本等市场

## 数据获取方法

### 方法1：从排名接口获取（推荐）

```python
import akshare as ak

# 获取所有开放基金的排名数据（包含QDII）
all_funds_rank_df = ak.fund_open_fund_rank_em(symbol="全部")

# 查找特定QDII基金
fund_006105 = all_funds_rank_df[all_funds_rank_df['基金代码'] == '006105']

# 显示关键字段
print(fund_006105[['基金代码', '基金简称', '日期', '单位净值', '日增长率', '近1月', '今年来']])
```

**优点**:
- ✅ 包含丰富的收益率数据（近1月、近3月、近6月、近1年、今年来）
- ✅ 数据更新及时
- ✅ 一次调用获取所有基金数据

**返回字段**:
- `基金代码`: 6位基金代码
- `基金简称`: 基金名称
- `日期`: 净值日期
- `单位净值`: 当日单位净值
- `日增长率`: 当日涨跌幅（%）
- `近1月`: 近1个月收益率（%）
- `近3月`: 近3个月收益率（%）
- `近6月`: 近6个月收益率（%）
- `近1年`: 近1年收益率（%）
- `今年来`: 今年以来收益率（%）

### 方法2：从历史净值接口获取

```python
import akshare as ak

# 获取QDII基金历史净值数据
fund_nav = ak.fund_open_fund_info_em(symbol="006105", indicator="单位净值走势")

# 按日期排序
fund_nav = fund_nav.sort_values('净值日期', ascending=True)

# 显示最近数据
print(fund_nav.tail(10))
```

**优点**:
- ✅ 提供完整的历史净值走势
- ✅ 可用于计算自定义指标
- ✅ 支持长期数据分析

**返回字段**:
- `净值日期`: 净值日期
- `单位净值`: 单位净值
- `日增长率`: 日涨跌幅（%）

### 方法3：从基本信息接口获取

```python
import akshare as ak

# 获取QDII基金基本信息
fund_info = ak.fund_open_fund_info_em(symbol="006105", indicator="基本信息")

print(fund_info)
```

**注意**:
- ⚠️ 部分QDII基金可能不提供基本信息接口
- ⚠️ 返回数据可能为空

## 数据一致性验证

不同接口返回的数据应该保持一致：

```python
# 排名接口的最新数据
rank_date = fund_rank.iloc[0]['日期']
rank_nav = fund_rank.iloc[0]['单位净值']
rank_growth = fund_rank.iloc[0]['日增长率']

# 历史净值接口的最新数据
latest_nav = fund_nav.iloc[-1]
nav_date = latest_nav['净值日期']
nav_value = latest_nav['单位净值']
nav_growth = latest_nav['日增长率']

# 验证一致性
assert str(rank_date) == str(nav_date), "日期不一致"
assert abs(rank_nav - nav_value) < 0.0001, "净值不一致"
assert abs(rank_growth - nav_growth) < 0.01, "增长率不一致"
```

## 测试用例

### 完整测试套件

```bash
python pro2/fund_search/tests/test_qdii_fund_006105.py
```

**测试内容**:
1. ✅ 排名接口数据获取
2. ✅ 历史净值数据获取
3. ✅ 基金基本信息获取
4. ✅ 数据一致性验证
5. ✅ QDII特性验证

### 快速测试

```bash
python pro2/fund_search/tests/quick_test_qdii_006105.py
```

**测试内容**:
- 快速验证核心数据获取功能
- 数据一致性检查
- QDII特性说明

## 注意事项

### 1. 数据更新时间
- QDII基金净值通常在 **T+1 日晚上** 更新
- 受海外市场时差影响，可能比国内基金晚更新
- 周末和节假日不更新

### 2. 数据格式
- 日增长率：百分比格式（如 1.23 表示 1.23%）
- 单位净值：元（保留4位小数）
- 日期格式：YYYY-MM-DD

### 3. 特殊情况处理
- **基本信息为空**: QDII基金可能不提供基本信息接口，这是正常现象
- **净值延迟**: 海外市场节假日可能导致净值延迟更新
- **汇率波动**: QDII基金净值受汇率影响，波动可能较大

### 4. 与普通基金的区别

| 特性 | 普通基金 | QDII基金 |
|------|---------|----------|
| 确认时间 | T+1 | T+2 |
| 赎回到账 | 3-5个工作日 | 7-10个工作日 |
| 投资范围 | 境内市场 | 境外市场 |
| 汇率影响 | 无 | 有 |
| 净值更新 | 及时 | 可能延迟 |
| 波动率 | 相对较低 | 相对较高 |

## 系统集成

QDII基金数据获取已集成到系统中，使用方式与普通基金相同：

```python
from data_retrieval.enhanced_fund_data import EnhancedFundData

# 创建数据管理器
fund_data_manager = EnhancedFundData()

# 获取QDII基金数据（与普通基金相同的接口）
basic_info = fund_data_manager.get_fund_basic_info("006105")
realtime_data = fund_data_manager.get_realtime_data("006105")
performance_metrics = fund_data_manager.get_performance_metrics("006105")
```

系统会自动处理QDII基金的特殊情况。

## 测试结果示例

```
================================================================================
QDII基金数据获取测试套件 - 国富全球科技互联混合(QDII)人民币 (006105)
测试时间: 2026-01-19 16:45:00
================================================================================

测试1：排名接口数据 - ✅ 通过
  基金代码: 006105
  基金简称: 宏利印度股票(QDII)A
  日期: 2026-01-15
  单位净值: 1.4261 元
  日增长率: 0.0%
  近1月: -1.11%
  今年来: -1.46%

测试2：历史净值数据 - ✅ 通过
  共 1691 条历史记录

测试3：基金基本信息 - ✅ 通过
  （QDII基金可能不提供基本信息接口）

测试4：数据一致性验证 - ✅ 通过
  日期一致 ✅
  净值一致 ✅
  增长率一致 ✅

测试5：QDII特性验证 - ✅ 通过
  近5日波动率: 0.3704%

总计: 5/5 测试通过
🎉 所有测试通过！
```

## 相关文档

- [字段计算逻辑说明](./字段计算逻辑说明.md)
- [新浪实时接口集成完成说明](./新浪实时接口集成完成说明.md)
- [昨日盈亏率计算逻辑修正说明](./昨日盈亏率计算逻辑修正说明.md)
