# 基金截图导入功能使用说明

## 功能概述

基金截图导入功能允许用户通过上传基金持仓截图，自动识别其中的基金代码和名称，快速导入到持仓列表中。

## 功能特点

- ✅ 支持多种截图格式（JPG、PNG）
- ✅ 自动识别基金代码（6位数字）
- ✅ 自动识别基金名称
- ✅ 支持批量识别多个基金
- ✅ 自动验证基金代码有效性
- ✅ 支持手动编辑识别结果
- ✅ 拖拽上传支持

## 使用步骤

### 1. 准备截图

确保截图清晰可读，包含以下信息：
- 基金代码（6位数字）
- 基金名称

**支持的截图来源：**
- 支付宝基金持仓截图
- 天天基金持仓截图
- 京东金融持仓截图
- 其他基金平台持仓截图

### 2. 上传截图

1. 点击"我的持仓"页面工具栏中的"截图导入"按钮
2. 在弹出的对话框中，点击"选择图片"或直接拖拽图片到上传区域
3. 等待图片预览加载完成

### 3. 开始识别

1. 点击"开始识别"按钮
2. 系统会自动使用OCR技术识别截图中的基金信息
3. 识别过程通常需要5-10秒

### 4. 确认识别结果

识别完成后，系统会显示识别到的基金列表，包括：
- 基金代码
- 基金名称
- 识别置信度

如果识别结果正确，点击"确认导入"按钮。

### 5. 填写持仓信息

在确认导入对话框中，为每个基金填写：
- **持有份额**：必填，您持有的基金份额
- **成本价**：必填，您的买入成本价
- **买入日期**：可选，首次买入日期

### 6. 完成导入

点击"确认导入"按钮，系统会将基金添加到您的持仓列表中。

## 识别原理

### OCR技术

系统使用以下OCR引擎进行文字识别：

1. **PaddleOCR**（主要方案）
   - 百度开源的OCR引擎
   - 中文识别效果好
   - 支持CPU和GPU加速

2. **EasyOCR**（备用方案）
   - 开源OCR引擎
   - 支持多种语言
   - 识别速度较快

### 识别流程

```
上传截图 → OCR文字识别 → 提取基金代码 → 匹配基金名称 → 验证有效性 → 返回结果
```

### 识别规则

1. **基金代码识别**
   - 查找6位连续数字
   - 验证代码格式是否正确

2. **基金名称识别**
   - 在代码前后查找文本
   - 清理特殊字符和标识
   - 移除QDII、LOF、FOF等后缀

3. **验证机制**
   - 通过AKShare接口验证基金代码是否存在
   - 获取真实的基金名称
   - 更新识别结果为真实名称

## 安装依赖

### 方案1：使用PaddleOCR（推荐）

```bash
cd pro2/fund_search
pip install -r requirements_ocr.txt
```

或手动安装：

```bash
# CPU版本
pip install paddleocr paddlepaddle

# GPU版本（如果有NVIDIA GPU）
pip install paddleocr paddlepaddle-gpu
```

### 方案2：使用EasyOCR（备用）

```bash
pip install easyocr
```

## 常见问题

### Q1: 识别失败怎么办？

**可能原因：**
- 截图不清晰
- 基金代码或名称被遮挡
- OCR依赖未安装

**解决方案：**
1. 重新截取更清晰的图片
2. 确保基金代码和名称完整可见
3. 检查OCR依赖是否正确安装

### Q2: 识别结果不准确怎么办？

**解决方案：**
1. 在确认导入对话框中手动修改识别结果
2. 或者手动添加基金到持仓列表

### Q3: 支持哪些截图格式？

**支持的格式：**
- JPG / JPEG
- PNG
- 最大文件大小：10MB

### Q4: 识别速度慢怎么办？

**优化建议：**
1. 使用GPU加速（如果有NVIDIA GPU）
2. 压缩截图文件大小
3. 使用更清晰的截图

### Q5: OCR依赖安装失败怎么办？

**常见问题：**

1. **PaddlePaddle安装失败**
   ```bash
   # 尝试使用清华镜像源
   pip install paddlepaddle -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

2. **EasyOCR安装失败**
   ```bash
   # 尝试使用清华镜像源
   pip install easyocr -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```

3. **依赖冲突**
   ```bash
   # 创建虚拟环境
   python -m venv venv_ocr
   source venv_ocr/bin/activate  # Linux/Mac
   venv_ocr\Scripts\activate  # Windows
   pip install -r requirements_ocr.txt
   ```

## 技术细节

### API端点

#### 1. 识别截图

```
POST /api/holdings/import/screenshot
```

**请求参数：**
```json
{
  "image": "data:image/png;base64,iVBORw0KG...",
  "use_gpu": false
}
```

**响应示例：**
```json
{
  "success": true,
  "data": [
    {
      "fund_code": "007721",
      "fund_name": "天弘标普500发起(QDII-FOF)A",
      "confidence": 0.85
    }
  ],
  "message": "成功识别 1 个基金，请确认信息后导入"
}
```

#### 2. 确认导入

```
POST /api/holdings/import/confirm
```

**请求参数：**
```json
{
  "user_id": "default_user",
  "funds": [
    {
      "fund_code": "007721",
      "fund_name": "天弘标普500发起(QDII-FOF)A",
      "holding_shares": 100.00,
      "cost_price": 6.8130,
      "buy_date": "2025-01-20",
      "confidence": 0.85
    }
  ]
}
```

**响应示例：**
```json
{
  "success": true,
  "imported": [
    {
      "fund_code": "007721",
      "fund_name": "天弘标普500发起(QDII-FOF)A",
      "holding_shares": 100.00,
      "cost_price": 6.8130
    }
  ],
  "failed": [],
  "message": "成功导入 1 个基金，0 个失败"
}
```

#### 3. 检查OCR状态

```
GET /api/holdings/import/ocr-status
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "ocr_available": true,
    "gpu_available": false,
    "supported_formats": ["png", "jpg", "jpeg"],
    "max_file_size": "10MB"
  }
}
```

## 示例截图

### 支付宝基金持仓截图

```
我的持有
全部(53)  股票型(8)  债券型(0)  混合型(0)

天弘标普500发起(QDII-FOF)A          681.30    +21.11
007721                              -1.16     +3.20%

景顺长城全球半导体芯片股票A(QDII-LOF)(人民币)  664.00    +83.08
501225                                        -1.20     +15.08%
```

### 识别结果

| 基金代码 | 基金名称 | 置信度 |
|---------|---------|--------|
| 007721 | 天弘标普500发起(QDII-FOF)A | 85% |
| 501225 | 景顺长城全球半导体芯片股票A(QDII-LOF)(人民币) | 85% |

## 注意事项

1. **隐私保护**
   - 截图仅在本地处理，不会上传到外部服务器
   - 识别完成后，截图数据会被清除

2. **识别准确性**
   - OCR识别准确率约85-95%
   - 建议在确认导入前仔细检查识别结果

3. **性能优化**
   - 首次使用时，OCR模型需要下载，可能需要几分钟
   - 后续使用会更快

4. **兼容性**
   - 支持Windows、Linux、macOS
   - 需要Python 3.8+

## 更新日志

### v1.0.0 (2026-01-21)

- ✅ 初始版本发布
- ✅ 支持PaddleOCR和EasyOCR
- ✅ 支持基金代码和名称识别
- ✅ 支持批量识别
- ✅ 支持拖拽上传
- ✅ 支持手动编辑识别结果

## 反馈与建议

如果您在使用过程中遇到问题或有改进建议，请联系开发团队。
