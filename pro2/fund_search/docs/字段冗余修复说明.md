# å­—æ®µå†—ä½™ä¿®å¤è¯´æ˜

## ä¿®å¤å†…å®¹

### 1. åˆ é™¤å†—ä½™å­—æ®µ `yesterday_return`

**é—®é¢˜ï¼š**
- `fund_analysis_results` è¡¨ä¸­åŒæ—¶å­˜åœ¨ `yesterday_return` å’Œ `prev_day_return` ä¸¤ä¸ªå­—æ®µ
- `yesterday_return` å­—æ®µä»æœªè¢«ä½¿ç”¨æˆ–èµ‹å€¼ï¼Œå±äºå†—ä½™å­—æ®µ

**ä¿®å¤æ–¹æ¡ˆï¼š**
- åœ¨æ•°æ®åº“åˆå§‹åŒ–æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶åˆ é™¤ `yesterday_return` å­—æ®µ
- ä¿®æ”¹æ–‡ä»¶ï¼š`pro2/fund_search/data_retrieval/enhanced_database.py`
- æ–°å¢æ–¹æ³•ï¼š`_remove_redundant_columns()`

**æ‰§è¡Œæ—¶æœºï¼š**
- ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
- å¦‚æœå­—æ®µä¸å­˜åœ¨ï¼Œä¼šè·³è¿‡åˆ é™¤æ“ä½œ
- ä¸ä¼šå½±å“ç°æœ‰æ•°æ®

### 2. æ·»åŠ æ•°æ®æºè°ƒè¯•æ—¥å¿—

**é—®é¢˜ï¼š**
- ç”¨æˆ·å‘ç° `today_return` å’Œ `prev_day_return` å­—æ®µå€¼ä¸º0
- éœ€è¦è¿½è¸ªæ•°æ®æ¥æºï¼Œå®šä½é—®é¢˜åŸå› 

**ä¿®å¤æ–¹æ¡ˆï¼š**
- åœ¨ `enhanced_main.py` çš„ `analyze_single_fund` æ–¹æ³•ä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—
- è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
  - å®æ—¶æ•°æ®è·å–ç»“æœï¼ˆcurrent_nav, previous_nav, daily_return, data_sourceï¼‰
  - ç»©æ•ˆæŒ‡æ ‡è®¡ç®—ç»“æœï¼ˆsharpe_ratio, composite_scoreï¼‰
  - æœ€ç»ˆæ”¶ç›Šç‡è®¡ç®—ç»“æœï¼ˆtoday_return, prev_day_returnï¼‰
  - ç­–ç•¥åˆ†æç»“æœï¼ˆstatus, action, buy_multiplier, redeem_amountï¼‰

**æ—¥å¿—çº§åˆ«ï¼š**
- `INFO` - å…³é”®æ•°æ®ç‚¹ï¼ˆæ”¶ç›Šç‡ã€ç­–ç•¥ç»“æœï¼‰
- `DEBUG` - è¯¦ç»†æ•°æ®ï¼ˆåŸºæœ¬ä¿¡æ¯ã€ç»©æ•ˆæŒ‡æ ‡ï¼‰

## ä½¿ç”¨æ–¹æ³•

### 1. è‡ªåŠ¨ä¿®å¤ï¼ˆæ¨èï¼‰

ç³»ç»Ÿå¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œä¿®å¤ï¼š

```bash
# å¯åŠ¨ä¸»ç¨‹åº
cd pro2/fund_search
python enhanced_main.py

# æˆ–å¯åŠ¨WebæœåŠ¡
cd pro2/fund_search/web
python app.py
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥ `yesterday_return` å­—æ®µæ˜¯å¦å­˜åœ¨
2. å¦‚æœå­˜åœ¨ï¼Œåˆ é™¤è¯¥å­—æ®µ
3. è®°å½•æ“ä½œæ—¥å¿—

### 2. æ‰‹åŠ¨è¯Šæ–­

è¿è¡Œè¯Šæ–­è„šæœ¬æ£€æŸ¥å­—æ®µå€¼æƒ…å†µï¼š

```bash
cd pro2/fund_search
python scripts/diagnose_field_values.py
```

è¯Šæ–­è„šæœ¬ä¼šè¾“å‡ºï¼š
- è¡¨ç»“æ„ä¿¡æ¯ï¼ˆæ‰€æœ‰å­—æ®µåˆ—è¡¨ï¼‰
- å­—æ®µå€¼ç»Ÿè®¡ï¼ˆé›¶å€¼/éé›¶å€¼æ¯”ä¾‹ï¼‰
- ç¤ºä¾‹æ•°æ®ï¼ˆå‰10æ¡è®°å½•ï¼‰
- å¼‚å¸¸æ•°æ®æ£€æŸ¥ï¼ˆä¸¤ä¸ªå­—æ®µéƒ½ä¸º0çš„è®°å½•ï¼‰
- è¯Šæ–­å»ºè®®

### 3. æŸ¥çœ‹æ—¥å¿—

æŸ¥çœ‹è¯¦ç»†çš„æ•°æ®è·å–æ—¥å¿—ï¼š

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f pro2/fund_search/fund_analysis.log

# æœç´¢ç‰¹å®šåŸºé‡‘çš„æ—¥å¿—
grep "åŸºé‡‘ 006105" pro2/fund_search/fund_analysis.log

# æœç´¢æ”¶ç›Šç‡ç›¸å…³æ—¥å¿—
grep "æ”¶ç›Šç‡è®¡ç®—å®Œæˆ" pro2/fund_search/fund_analysis.log
```

## æ—¥å¿—ç¤ºä¾‹

### æ­£å¸¸æƒ…å†µ

```
2026-01-20 15:30:00 - INFO - å¼€å§‹åˆ†æåŸºé‡‘: 006105 - å®åˆ©å°åº¦è‚¡ç¥¨(QDII)A
2026-01-20 15:30:01 - INFO - åŸºé‡‘ 006105 å®æ—¶æ•°æ®: current_nav=1.2345, previous_nav=1.2200, daily_return=1.19, yesterday_return=0.82, data_source=akshare_qdii
2026-01-20 15:30:02 - INFO - åŸºé‡‘ 006105 æ”¶ç›Šç‡è®¡ç®—å®Œæˆ: today_return=1.19%, prev_day_return=0.82%
2026-01-20 15:30:03 - INFO - åŸºé‡‘ 006105 åˆ†æå®Œæˆ: status=ğŸŸ¢ è¿ç»­æ¶¨, action=buy, buy_multiplier=1.5, redeem_amount=0
```

### å¼‚å¸¸æƒ…å†µï¼ˆæ•°æ®ä¸º0ï¼‰

```
2026-01-20 15:30:00 - INFO - å¼€å§‹åˆ†æåŸºé‡‘: 100055 - å¯Œå›½å…¨çƒç§‘æŠ€äº’è”ç½‘è‚¡ç¥¨(QDII)A
2026-01-20 15:30:01 - INFO - åŸºé‡‘ 100055 å®æ—¶æ•°æ®: current_nav=0, previous_nav=0, daily_return=0, yesterday_return=0, data_source=akshare_qdii
2026-01-20 15:30:01 - WARNING - åŸºé‡‘ 100055 ä»Šæ—¥æ”¶ç›Šç‡å¼‚å¸¸: 0.0%ï¼Œä½¿ç”¨é»˜è®¤å€¼0.0%
2026-01-20 15:30:02 - INFO - åŸºé‡‘ 100055 æ”¶ç›Šç‡è®¡ç®—å®Œæˆ: today_return=0.0%, prev_day_return=0.0%
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: ä¸ºä»€ä¹ˆ today_return å’Œ prev_day_return éƒ½æ˜¯0ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. **éäº¤æ˜“æ—¥** - å‘¨æœ«æˆ–èŠ‚å‡æ—¥ï¼ŒåŸºé‡‘å‡€å€¼æœªæ›´æ–°
2. **æ•°æ®æ¥å£å¤±è´¥** - AKShareæˆ–æ–°æµªæ¥å£è¿”å›ç©ºæ•°æ®
3. **QDIIåŸºé‡‘å»¶è¿Ÿ** - QDIIåŸºé‡‘å‡€å€¼æ›´æ–°æœ‰å»¶è¿Ÿ

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ˜¯å¦ä¸ºäº¤æ˜“æ—¥
2. æŸ¥çœ‹æ—¥å¿—ä¸­çš„ `data_source` å­—æ®µ
3. æ£€æŸ¥ `current_nav` å’Œ `previous_nav` æ˜¯å¦ä¸º0
4. å¦‚æœæ˜¯QDIIåŸºé‡‘ï¼Œæ£€æŸ¥AKShareæ¥å£æ˜¯å¦æ­£å¸¸

### Q2: å¦‚ä½•ç¡®è®¤å†—ä½™å­—æ®µå·²åˆ é™¤ï¼Ÿ

**æ–¹æ³•1ï¼šè¿è¡Œè¯Šæ–­è„šæœ¬**
```bash
python scripts/diagnose_field_values.py
```
æŸ¥çœ‹è¾“å‡ºä¸­æ˜¯å¦æœ‰ "âœ… å†—ä½™å­—æ®µ yesterday_return å·²åˆ é™¤"

**æ–¹æ³•2ï¼šç›´æ¥æŸ¥è¯¢æ•°æ®åº“**
```sql
SELECT COLUMN_NAME 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_SCHEMA = 'fund_analysis' 
AND TABLE_NAME = 'fund_analysis_results'
AND COLUMN_NAME = 'yesterday_return';
```
å¦‚æœè¿”å›ç©ºç»“æœï¼Œè¯´æ˜å­—æ®µå·²åˆ é™¤

### Q3: åˆ é™¤å­—æ®µä¼šå½±å“ç°æœ‰æ•°æ®å—ï¼Ÿ

**ä¸ä¼šã€‚**
- åˆ é™¤çš„æ˜¯è¡¨ç»“æ„ä¸­çš„å­—æ®µå®šä¹‰
- ä¸ä¼šåˆ é™¤å…¶ä»–å­—æ®µçš„æ•°æ®
- `yesterday_return` å­—æ®µæœ¬èº«å°±æ²¡æœ‰æ•°æ®ï¼ˆä»æœªè¢«èµ‹å€¼ï¼‰

## ä¿®æ”¹çš„æ–‡ä»¶

1. **pro2/fund_search/data_retrieval/enhanced_database.py**
   - æ–°å¢ `_remove_redundant_columns()` æ–¹æ³•
   - åœ¨ `_create_fund_analysis_results_table()` ä¸­è°ƒç”¨

2. **pro2/fund_search/enhanced_main.py**
   - åœ¨ `analyze_single_fund()` æ–¹æ³•ä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—
   - è®°å½•å®æ—¶æ•°æ®ã€æ”¶ç›Šç‡è®¡ç®—ã€ç­–ç•¥åˆ†æç»“æœ

3. **pro2/fund_search/scripts/diagnose_field_values.py**ï¼ˆæ–°å¢ï¼‰
   - æ•°æ®åº“å­—æ®µå€¼è¯Šæ–­è„šæœ¬
   - æ£€æŸ¥è¡¨ç»“æ„ã€ç»Ÿè®¡å­—æ®µå€¼ã€æ˜¾ç¤ºç¤ºä¾‹æ•°æ®

4. **pro2/fund_search/docs/å­—æ®µè®¡ç®—é€»è¾‘è¯´æ˜.md**ï¼ˆæ–°å¢ï¼‰
   - å®Œæ•´çš„å­—æ®µåˆ†ææ–‡æ¡£
   - æ•°æ®æµè¯´æ˜ã€å­—æ®µå‘½åè§„èŒƒ

5. **pro2/fund_search/docs/å­—æ®µå†—ä½™ä¿®å¤è¯´æ˜.md**ï¼ˆæœ¬æ–‡æ¡£ï¼‰
   - ä¿®å¤å†…å®¹è¯´æ˜
   - ä½¿ç”¨æ–¹æ³•å’Œå¸¸è§é—®é¢˜

## åç»­å»ºè®®

1. **å®šæœŸæ£€æŸ¥æ—¥å¿—**
   - å…³æ³¨æ”¶ç›Šç‡ä¸º0çš„æƒ…å†µ
   - åŠæ—¶å‘ç°æ•°æ®è·å–é—®é¢˜

2. **ç›‘æ§æ•°æ®è´¨é‡**
   - å®šæœŸè¿è¡Œè¯Šæ–­è„šæœ¬
   - ç»Ÿè®¡é›¶å€¼æ¯”ä¾‹

3. **ä¼˜åŒ–æ•°æ®è·å–**
   - å¦‚æœå‘ç°æŸäº›åŸºé‡‘ç»å¸¸è·å–å¤±è´¥
   - è€ƒè™‘æ·»åŠ é‡è¯•æœºåˆ¶æˆ–å¤‡ç”¨æ•°æ®æº

---

**ä¿®å¤æ—¥æœŸï¼š** 2026-01-20  
**ä¿®å¤äººå‘˜ï¼š** Kiro AI Assistant
