# =============================================================================
# Celery 配置
# =============================================================================

# Broker 配置
broker_url: memory://
result_backend: cache+memory://

# 任务执行模式
task_always_eager: true        # 同步执行（开发/测试环境）
task_eager_propagates: true
task_store_eager_result: true

# 序列化配置
task_serializer: json
accept_content:
  - json
result_serializer: json

# 时区配置
timezone: Asia/Shanghai
enable_utc: true

# Worker 配置
worker_concurrency: 4
worker_prefetch_multiplier: 1
worker_max_tasks_per_child: 100
task_track_started: true

# 默认队列
task_default_queue: default

# 任务路由配置
task_routes:
  celery_tasks.tasks.update_fund_nav_task:
    queue: data_sync
  celery_tasks.tasks.update_nav_history_task:
    queue: data_sync
  celery_tasks.tasks.sync_fund_data_task:
    queue: data_sync
  celery_tasks.tasks.batch_update_task:
    queue: data_sync
  celery_tasks.tasks.run_backtest_task:
    queue: backtest
  celery_tasks.tasks.recalc_performance_task:
    queue: calculation
  celery_tasks.tasks.clear_expired_cache_task:
    queue: default
  celery_tasks.tasks.send_notification_task:
    queue: default

# 环境变量覆盖:
#   FUND_CELERY_BROKER_URL       - Broker URL
#   FUND_CELERY_RESULT_BACKEND   - 结果后端
#   FUND_CELERY_WORKER_CONCURRENCY - Worker 并发数
#   CELERY_WORKER_CONCURRENCY    - Worker 并发数（兼容旧配置）
