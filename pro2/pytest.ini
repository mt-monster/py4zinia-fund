[pytest]
# 测试配置
minversion = 7.0

# 测试路径
testpaths =
    tests/unit
    tests/integration

# Python路径
pythonpath = 
    fund_search
    .

# 标记定义
markers =
    unit: 单元测试 - 不依赖外部服务
    integration: 集成测试 - 测试组件交互
    api: API测试 - 测试接口端点
    database: 数据库测试 - 测试数据库操作
    slow: 慢速测试 - 执行时间较长的测试
    smoke: 冒烟测试 - 快速验证基本功能
    performance: 性能测试 - 测试性能指标

# 忽略的路径
norecursedirs =
    .git
    .venv
    venv
    __pycache__
    build
    dist
    *.egg-info
    .pytest_cache
    .mypy_cache

# 默认选项
addopts =
    -v
    --strict-markers
    --tb=short
    --color=yes
    --code-highlight=yes

# 日志配置
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_file_date_format = %Y-%m-%d %H:%M:%S

# 覆盖率配置
[coverage:run]
source = fund_search
omit =
    */tests/*
    */test_*
    */__pycache__/*
    */venv/*
    */.venv/*
    setup.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:

[coverage:html]
directory = tests/reports/coverage

[coverage:xml]
output = tests/reports/coverage.xml
