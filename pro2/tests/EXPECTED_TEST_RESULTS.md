# 数据源对比测试 - 预期结果

## 测试环境信息

```
测试时间: 2026-02-09
测试基金: 021539 (华安法国CAC40ETF发起式联接(QDII)A)
测试地点: 中国大陆
Python版本: 3.11+
Akshare版本: 1.15+
Tushare版本: 1.4+
```

---

## 预期测试结果

### 1. 基金基本信息获取

#### Akshare 预期结果
```
状态: ✓ 成功
响应时间: 1.5s - 3.0s
数据字段:
  - 基金简称: 华安法国CAC40ETF发起式联接(QDII)A
  - 基金类型: QDII-指数型
  - 成立日期: 2024-05-28
  - 基金管理人: 华安基金
  - 基金经理: 倪斌
  - 管理费率: 0.50%
  - 托管费率: 0.10%
  - 业绩比较基准: 法国CAC40指数收益率×95%+商业银行税后活期存款利率×5%
```

#### Tushare 预期结果
```
状态: ✓ 成功 (如果token有效)
响应时间: 0.8s - 2.0s
数据字段:
  - ts_code: 021539
  - name: 华安法国CAC40ETF发起式联接(QDII)A
  - invest_type: 指数型
  - setup_date: 20240528
  - management: 华安基金
  - 其他字段...
```

---

### 2. 历史净值数据获取

#### Akshare 预期结果
```
状态: ✓ 成功
响应时间: 2.0s - 4.0s
数据条数: 150-200条 (成立以来约200天)
日期范围: 2024-05-28 至 2026-02-09
数据格式:
  净值日期    单位净值   累计净值   日增长率  申购状态  赎回状态
  2026-02-09  1.2345    1.2345     0.85%     开放     开放
  2026-02-08  1.2241    1.2241    -0.32%     开放     开放
  ...
```

#### Tushare 预期结果
```
状态: ✓ 成功 (如果token有效且有权限)
响应时间: 1.0s - 2.5s
数据条数: 150-200条
数据格式:
  nav_date   unit_nav  accum_nav  nv_daily_growth
  20260209   1.2345    1.2345     0.0085
  20260208   1.2241    1.2241    -0.0032
  ...
```

**关键发现**: QDII基金净值T+2更新
- 2月9日看到的数据实际是2月7日的净值
- 受法国股市交易时间影响

---

### 3. 实时/最新数据获取

#### Akshare 预期结果
```
状态: ✓ 成功 (返回历史最新，非实时)
响应时间: 1.5s - 3.0s
最新数据:
  - 净值日期: 2026-02-09
  - 单位净值: 1.2345
  - 日增长率: +0.85%
  - 数据来源: akshare

注意: QDII基金无实时估算，返回的是已公布的最新净值
```

#### Tushare 预期结果
```
状态: ✓ 成功
响应时间: 0.5s - 1.5s
最新数据:
  - nav_date: 20260209
  - unit_nav: 1.2345
  - nv_daily_growth: 0.0085
  - 数据来源: tushare
```

---

### 4. 稳定性测试 (连续5次请求)

#### Akshare 预期结果
```
成功率: 80% - 95%
平均响应: 2.0s

请求记录:
  第1次: 1.85s ✓
  第2次: 2.12s ✓
  第3次: 1.97s ✓
  第4次: 超时/反爬 ✗ (偶尔发生)
  第5次: 2.05s ✓

可能错误:
  - 请求超时 (>10s)
  - 反爬限制 (返回HTML错误页)
```

#### Tushare 预期结果
```
成功率: 95% - 100%
平均响应: 1.0s

请求记录:
  第1次: 0.95s ✓
  第2次: 1.02s ✓
  第3次: 0.88s ✓
  第4次: 0.91s ✓
  第5次: 0.97s ✓

可能错误:
  - 积分不足 (频繁请求)
  - 权限不足 (部分数据需高级权限)
```

---

## QDII基金特殊处理对比

### Akshare QDII处理
```python
# 当前项目实现
fund_nav = ak.fund_open_fund_daily_em(symbol="021539")
latest = fund_nav.iloc[-1]

# 特点:
✓ 获取历史净值完整
✓ 包含申购/赎回状态
✓ 自动识别日增长率格式
✗ 无实时估算数据
✗ 响应时间稍长
```

### Tushare QDII处理
```python
# 可能的实现
nav = pro.fund_nav(ts_code="021539")

# 特点:
✓ 响应速度快
✓ 数据标准化程度高
✗ 需要token
✗ 部分字段可能缺失
✗ 有积分消耗
```

---

## 数据准确性对比

| 数据项 | Akshare | Tushare | 官方对比 |
|--------|---------|---------|----------|
| 单位净值 | ±0.0001 | ±0.0001 | 99.9%一致 |
| 日增长率 | ±0.01% | ±0.01% | 99.9%一致 |
| 累计净值 | ±0.0001 | ±0.0001 | 99.9%一致 |
| 净值日期 | T+0 | T+0 | 准确 |
| 申购状态 | 准确 | 可能缺失 | - |

---

## 推荐配置

### 生产环境推荐
```python
# 初始化配置
fetcher = MultiSourceFundData(
    tushare_token="your_token",  # 备用数据源
    timeout=15                    # 网络超时
)

# 使用策略:
# 1. 优先使用 Akshare (免费、QDII处理成熟)
# 2. Akshare失败时自动切换到 Tushare
# 3. 记录数据源健康状态
```

### 开发环境推荐
```python
# 仅使用 Akshare
fetcher = MultiSourceFundData()

# 简单、免费、无需配置
```

---

## 常见问题预期

### 问题1: Tushare返回空数据
**原因**: 
- 基金代码格式问题 (需确认是否为Tushare支持格式)
- Token权限不足

**解决**:
- 检查token有效性
- 确认基金在Tushare数据库中
- 使用Akshare作为备用

### 问题2: Akshare偶尔超时
**原因**:
- 网络波动
- 东方财富网反爬策略

**解决**:
- 增加重试机制
- 使用Tushare作为备用
- 增加请求延迟

### 问题3: QDII基金数据延迟
**原因**:
- QDII基金T+2更新是正常特性
- 受海外市场交易时间影响

**解决**:
- 正确理解QDII基金特性
- 在UI中标注数据更新延迟
- 不期望获取实时数据

---

## 总结

| 维度 | 推荐 | 说明 |
|------|-----|------|
| 主数据源 | Akshare | 免费、开源、QDII处理成熟 |
| 备用数据源 | Tushare | 稳定性高、响应快 |
| QDII基金 | Akshare | 特殊处理逻辑更完善 |
| 生产环境 | 双数据源 | 提高可靠性 |
| 开发环境 | Akshare | 简单、免费 |

---

**文档版本**: 1.0  
**更新日期**: 2026-02-09
